

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Time_Warp &mdash; Time Warp IDE 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Time Warp IDE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language_reference.html">Language Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language_reference.html#pilot-language">PILOT Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language_reference.html#basic-language">BASIC Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language_reference.html#logo-language">Logo Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language_reference.html#built-in-functions">Built-in Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language_reference.html#operators">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html#pilot-tutorials">PILOT Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html#basic-tutorials">BASIC Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html#logo-tutorials">Logo Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html#advanced-tutorials">Advanced Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html#exercises">Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html#next-steps">Next Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#pilot-examples">PILOT Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#basic-examples">BASIC Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#logo-examples">Logo Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#mixed-language-examples">Mixed Language Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#educational-examples">Educational Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#running-the-examples">Running the Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#modifying-examples">Modifying Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#next-steps">Next Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#architecture-overview">Architecture Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#development-setup">Development Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#development-workflow">Development Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#adding-new-languages">Adding New Languages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#plugin-development">Plugin Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#theme-development">Theme Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#game-development">Game Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#api-reference">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#contributing">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#building-and-distribution">Building and Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#troubleshooting-development-issues">Troubleshooting Development Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#performance-optimization">Performance Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#future-development">Future Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#community-and-support">Community and Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide.html#license">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#installation-issues">Installation Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#runtime-issues">Runtime Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#program-execution-issues">Program Execution Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#plugin-issues">Plugin Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#performance-issues">Performance Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#debugging-issues">Debugging Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#getting-help">Getting Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#system-information">System Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#advanced-troubleshooting">Advanced Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#hardware-specific-issues">Hardware-Specific Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#preventive-maintenance">Preventive Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#emergency-recovery">Emergency Recovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#contact-support">Contact Support</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Time Warp IDE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">Time_Warp</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for Time_Warp</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># Time Warp Interpreter - Complete Implementation</span>
<span class="c1"># For integration with Time Warp IDE</span>

<span class="kn">import</span> <span class="nn">tkinter</span> <span class="k">as</span> <span class="nn">tk</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">ttk</span><span class="p">,</span> <span class="n">scrolledtext</span><span class="p">,</span> <span class="n">messagebox</span><span class="p">,</span> <span class="n">simpledialog</span><span class="p">,</span> <span class="n">filedialog</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Import plugin system</span>
<span class="kn">from</span> <span class="nn">core.plugin_system</span> <span class="kn">import</span> <span class="n">PluginManager</span>


<div class="viewcode-block" id="ArduinoController">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.ArduinoController">[docs]</a>
<span class="k">class</span> <span class="nc">ArduinoController</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Arduino hardware controller with simulation support&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_mode</span> <span class="o">=</span> <span class="n">simulation_mode</span></div>



<div class="viewcode-block" id="RPiController">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.RPiController">[docs]</a>
<span class="k">class</span> <span class="nc">RPiController</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raspberry Pi hardware controller with simulation support&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulation_mode</span> <span class="o">=</span> <span class="n">simulation_mode</span></div>



<div class="viewcode-block" id="AudioMixer">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.AudioMixer">[docs]</a>
<span class="k">class</span> <span class="nc">AudioMixer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Audio mixer for playing sounds with play/aplay support&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># name -&gt; path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_play</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_exe</span><span class="p">(</span><span class="s2">&quot;play&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_aplay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_exe</span><span class="p">(</span><span class="s2">&quot;aplay&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_has_exe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">os</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PATH&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="AudioMixer.register_sound">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.AudioMixer.register_sound">[docs]</a>
    <span class="k">def</span> <span class="nf">register_sound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a sound file with a name&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span></div>


<div class="viewcode-block" id="AudioMixer.play_sound">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.AudioMixer.play_sound">[docs]</a>
    <span class="k">def</span> <span class="nf">play_sound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Play a registered sound&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_play</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;play -q </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_aplay</span> <span class="ow">and</span> <span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.wav&quot;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;aplay -q </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fallback: system bell</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\a</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>
</div>



<span class="c1"># Easing functions for animations</span>
<span class="n">EASE_FUNCTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;linear&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">,</span>
    <span class="s2">&quot;quadOut&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">),</span>
    <span class="s2">&quot;quadIn&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span>
    <span class="s2">&quot;smooth&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="p">),</span>
<span class="p">}</span>


<div class="viewcode-block" id="Tween">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.Tween">[docs]</a>
<span class="k">class</span> <span class="nc">Tween</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Animation tween for smoothly changing values over time&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">store</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">start_val</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">end_val</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">duration_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ease</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">start_val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">end_val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration_ms</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ease</span> <span class="o">=</span> <span class="n">EASE_FUNCTIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ease</span><span class="p">,</span> <span class="n">EASE_FUNCTIONS</span><span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="Tween.step">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.Tween.step">[docs]</a>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt_ms</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">+=</span> <span class="n">dt_ms</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ease</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_val</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_val</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_val</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_val</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">True</span></div>
</div>



<div class="viewcode-block" id="Timer">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.Timer">[docs]</a>
<span class="k">class</span> <span class="nc">Timer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delayed action timer&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delay_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">delay_ms</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span></div>



<div class="viewcode-block" id="Particle">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.Particle">[docs]</a>
<span class="k">class</span> <span class="nc">Particle</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Particle for visual effects&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">life_ms</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#ffaa33&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vx</span> <span class="o">=</span> <span class="n">vx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vy</span> <span class="o">=</span> <span class="n">vy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">life</span> <span class="o">=</span> <span class="n">life_ms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>

<div class="viewcode-block" id="Particle.step">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.Particle.step">[docs]</a>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt_ms</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vx</span> <span class="o">*</span> <span class="p">(</span><span class="n">dt_ms</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vy</span> <span class="o">*</span> <span class="p">(</span><span class="n">dt_ms</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vy</span> <span class="o">-=</span> <span class="mi">30</span> <span class="o">*</span> <span class="p">(</span><span class="n">dt_ms</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>  <span class="c1"># gravity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">life</span> <span class="o">-=</span> <span class="n">dt_ms</span></div>
</div>



<div class="viewcode-block" id="ToolTip">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.ToolTip">[docs]</a>
<span class="k">class</span> <span class="nc">ToolTip</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lightweight tooltip helper usable across the UI.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="n">delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tipwindow</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Enter&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Leave&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">)</span>

<div class="viewcode-block" id="ToolTip.schedule">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.ToolTip.schedule">[docs]</a>
    <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ToolTip.show">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.ToolTip.show">[docs]</a>
    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipwindow</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">winfo_rootx</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">winfo_rooty</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">winfo_height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tipwindow</span> <span class="o">=</span> <span class="n">tw</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">)</span>
            <span class="n">tw</span><span class="o">.</span><span class="n">wm_overrideredirect</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">tw</span><span class="o">.</span><span class="n">wm_geometry</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;+</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
                <span class="n">tw</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                <span class="n">justify</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span>
                <span class="n">background</span><span class="o">=</span><span class="s2">&quot;#ffffe0&quot;</span><span class="p">,</span>
                <span class="n">relief</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">SOLID</span><span class="p">,</span>
                <span class="n">borderwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">ipadx</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ipady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tipwindow</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ToolTip.hide">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.ToolTip.hide">[docs]</a>
    <span class="k">def</span> <span class="nf">hide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">after_cancel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipwindow</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tipwindow</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tipwindow</span> <span class="o">=</span> <span class="kc">None</span></div>
</div>



<div class="viewcode-block" id="TimeWarpInterpreter">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter">[docs]</a>
<span class="k">class</span> <span class="nc">TimeWarpInterpreter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_widget</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_widget</span> <span class="o">=</span> <span class="n">output_widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">procedures</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># For-loop stack: list of dicts with keys: var, end, step, for_line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">for_stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">match_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Internal flag: set when a Y: or N: was the last command to allow</span>
        <span class="c1"># the immediately following T: to be treated as conditional.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_match_set</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">breakpoints</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_iterations</span> <span class="o">=</span> <span class="mi">10000</span>  <span class="c1"># Prevent infinite loops</span>

        <span class="c1"># DATA/READ/RESTORE support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of data values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_pointer</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Current position in data list</span>

        <span class="c1"># Turtle graphics state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1"># canvas x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1"># canvas y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">=</span> <span class="mi">90</span>  <span class="c1"># degrees, 90 = up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pen_down</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pen_width</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas_width</span> <span class="o">=</span> <span class="mi">400</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas_height</span> <span class="o">=</span> <span class="mi">400</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">=</span> <span class="mi">200</span>

        <span class="c1"># Color palette for SETCOLOR numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="s2">&quot;blue&quot;</span><span class="p">,</span>
            <span class="s2">&quot;red&quot;</span><span class="p">,</span>
            <span class="s2">&quot;green&quot;</span><span class="p">,</span>
            <span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;magenta&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cyan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;white&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gray&quot;</span><span class="p">,</span>
            <span class="s2">&quot;orange&quot;</span><span class="p">,</span>
            <span class="s2">&quot;purple&quot;</span><span class="p">,</span>
            <span class="s2">&quot;brown&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pink&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lightblue&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lightgreen&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># Hardware controllers (simulation mode by default)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arduino_controller</span> <span class="o">=</span> <span class="n">ArduinoController</span><span class="p">(</span><span class="n">simulation_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rpi_controller</span> <span class="o">=</span> <span class="n">RPiController</span><span class="p">(</span><span class="n">simulation_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Audio mixer (for sound playback)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audio_mixer</span> <span class="o">=</span> <span class="n">AudioMixer</span><span class="p">()</span>

        <span class="c1"># Animation and particle systems</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tweens</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of active tweens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timers</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of active timers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particles</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List of active particles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sprites</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{}</span>
        <span class="p">)</span>  <span class="c1"># Sprite registry: name -&gt; {&#39;path&#39;: str, &#39;x&#39;: float, &#39;y&#39;: float}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hud_enabled</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># HUD display toggle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># For delta time calculations</span>

        <span class="c1"># Logo procedures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logo_procedures</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Logo procedure definitions</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset_turtle</span><span class="p">()</span>

<div class="viewcode-block" id="TimeWarpInterpreter.reset">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset interpreter state&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">procedures</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">for_stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">match_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_match_set</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_turtle</span><span class="p">()</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.reset_turtle">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.reset_turtle">[docs]</a>
    <span class="k">def</span> <span class="nf">reset_turtle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pen_down</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pen_width</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sprites</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Reset sprite system</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.move_turtle">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.move_turtle">[docs]</a>
    <span class="k">def</span> <span class="nf">move_turtle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Move turtle forward/backward by distance, drawing if pen is down&quot;&quot;&quot;</span>
        <span class="c1"># Calculate new position</span>
        <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span><span class="p">)</span>
        <span class="n">new_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span>
        <span class="n">new_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span> <span class="o">-</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span>  <span class="c1"># Negative for up</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen_down</span><span class="p">:</span>
                <span class="c1"># Draw line from current to new position</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">+</span> <span class="n">new_x</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">-</span> <span class="n">new_y</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">create_line</span><span class="p">(</span>
                    <span class="n">x1</span><span class="p">,</span>
                    <span class="n">y1</span><span class="p">,</span>
                    <span class="n">x2</span><span class="p">,</span>
                    <span class="n">y2</span><span class="p">,</span>
                    <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pen_width</span><span class="p">,</span>
                    <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;turtle&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="c1"># Update turtle position (always, regardless of graphics)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span> <span class="o">=</span> <span class="n">new_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span> <span class="o">=</span> <span class="n">new_y</span>

        <span class="c1"># Update HUD if enabled</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hud_enabled</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_hud</span><span class="p">()</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.draw_circle_at">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.draw_circle_at">[docs]</a>
    <span class="k">def</span> <span class="nf">draw_circle_at</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">start_angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_angle</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">1.0</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw a circle or arc at specified coordinates&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Convert to canvas coordinates</span>
        <span class="n">canvas_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">+</span> <span class="n">x</span>
        <span class="n">canvas_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">-</span> <span class="n">y</span>

        <span class="c1"># Calculate bounding box</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">aspect</span>

        <span class="c1"># Draw the circle/arc</span>
        <span class="k">if</span> <span class="n">start_angle</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">end_angle</span> <span class="o">==</span> <span class="mi">360</span><span class="p">:</span>
            <span class="c1"># Full circle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span>
                <span class="n">canvas_x</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span>
                <span class="n">canvas_y</span> <span class="o">-</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">aspect</span><span class="p">,</span>
                <span class="n">canvas_x</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span>
                <span class="n">canvas_y</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">aspect</span><span class="p">,</span>
                <span class="n">outline</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pen_width</span><span class="p">,</span>
                <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;graphics&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Arc</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">start_angle</span>
            <span class="n">extent</span> <span class="o">=</span> <span class="n">end_angle</span> <span class="o">-</span> <span class="n">start_angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">create_arc</span><span class="p">(</span>
                <span class="n">canvas_x</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span>
                <span class="n">canvas_y</span> <span class="o">-</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">aspect</span><span class="p">,</span>
                <span class="n">canvas_x</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span>
                <span class="n">canvas_y</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">aspect</span><span class="p">,</span>
                <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
                <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                <span class="n">outline</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pen_width</span><span class="p">,</span>
                <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;graphics&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.execute_draw_commands">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.execute_draw_commands">[docs]</a>
    <span class="k">def</span> <span class="nf">execute_draw_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">draw_string</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute DRAW command string with turtle graphics commands&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># DRAW commands: UnDnRlLeFgHhEeNn... etc.</span>
        <span class="c1"># U - pen up, D - pen down, NnEeSsWw - directions, F - forward, B - back, etc.</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">original_pen_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen_down</span>
        <span class="n">original_heading</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">draw_string</span><span class="p">):</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="s2">&quot;UD&quot;</span><span class="p">:</span>  <span class="c1"># Pen Up/Down</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pen_down</span> <span class="o">=</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;D&quot;</span>
                <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="s2">&quot;NESW&quot;</span><span class="p">:</span>  <span class="c1"># Directions</span>
                    <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">=</span> <span class="mi">90</span>
                    <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">=</span> <span class="mi">270</span>
                    <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;W&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">=</span> <span class="mi">180</span>
                <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="s2">&quot;FB&quot;</span><span class="p">:</span>  <span class="c1"># Forward/Back</span>
                    <span class="c1"># Parse number</span>
                    <span class="n">num_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">draw_string</span><span class="p">)</span> <span class="ow">and</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                        <span class="n">num_str</span> <span class="o">+=</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">num_str</span><span class="p">:</span>
                        <span class="n">distance</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_str</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span>
                            <span class="n">distance</span> <span class="o">=</span> <span class="o">-</span><span class="n">distance</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">move_turtle</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>  <span class="c1"># No number found, back up</span>
                <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span>  <span class="c1"># Right turn</span>
                    <span class="n">num_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">draw_string</span><span class="p">)</span> <span class="ow">and</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                        <span class="n">num_str</span> <span class="o">+=</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">num_str</span><span class="p">:</span>
                        <span class="n">angle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_str</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">-</span> <span class="n">angle</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span>  <span class="c1"># Left turn</span>
                    <span class="n">num_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">draw_string</span><span class="p">)</span> <span class="ow">and</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                        <span class="n">num_str</span> <span class="o">+=</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">num_str</span><span class="p">:</span>
                        <span class="n">angle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_str</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">+</span> <span class="n">angle</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;M&quot;</span><span class="p">:</span>  <span class="c1"># Move to coordinates</span>
                    <span class="c1"># Parse x,y coordinates</span>
                    <span class="n">x_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">y_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">draw_string</span><span class="p">)</span> <span class="ow">and</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;,&quot;</span><span class="p">:</span>
                        <span class="n">x_str</span> <span class="o">+=</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">draw_string</span><span class="p">)</span> <span class="ow">and</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;,&quot;</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># skip comma</span>
                        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">draw_string</span><span class="p">)</span> <span class="ow">and</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;;&quot;</span><span class="p">:</span>
                            <span class="n">y_str</span> <span class="o">+=</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">draw_string</span><span class="p">)</span> <span class="ow">and</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;;&quot;</span><span class="p">:</span>
                            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># skip semicolon</span>

                    <span class="k">if</span> <span class="n">x_str</span> <span class="ow">and</span> <span class="n">y_str</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_str</span><span class="p">)</span>
                            <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_str</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span> <span class="o">=</span> <span class="n">x</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span> <span class="o">=</span> <span class="n">y</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>  <span class="c1"># Set color</span>
                    <span class="n">num_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">draw_string</span><span class="p">)</span> <span class="ow">and</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                        <span class="n">num_str</span> <span class="o">+=</span> <span class="n">draw_string</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">num_str</span><span class="p">:</span>
                        <span class="n">color_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_str</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">color_idx</span><span class="p">]</span>
                <span class="c1"># Skip unrecognized commands</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Restore original state if needed</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.play_music_string">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.play_music_string">[docs]</a>
    <span class="k">def</span> <span class="nf">play_music_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">music_string</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Play music using GW-BASIC PLAY command syntax&quot;&quot;&quot;</span>
        <span class="c1"># GW-BASIC PLAY syntax: A-G for notes, # + for sharp/flat, octave numbers, etc.</span>
        <span class="c1"># For now, we&#39;ll implement a basic version that logs the music string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Playing music: </span><span class="si">{</span><span class="n">music_string</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># In a full implementation, this would parse the music string and play notes</span>
        <span class="c1"># For now, we&#39;ll just play a beep for each note-like character</span>
        <span class="n">note_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">music_string</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="s2">&quot;ABCDEFG&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">note_count</span><span class="p">,</span> <span class="mi">10</span><span class="p">)):</span>  <span class="c1"># Limit to avoid too many beeps</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">audio_mixer</span><span class="o">.</span><span class="n">play_sound</span><span class="p">(</span><span class="s2">&quot;beep&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Short delay between notes</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\a</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.play_sound">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.play_sound">[docs]</a>
    <span class="k">def</span> <span class="nf">play_sound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">voice</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Play a sound with specified frequency, duration, volume, and voice&quot;&quot;&quot;</span>
        <span class="c1"># Convert GW-BASIC parameters to something playable</span>
        <span class="c1"># frequency: Hz, duration: clock ticks (18.2 ticks/second), volume: 0-255, voice: 0-3</span>

        <span class="k">if</span> <span class="n">frequency</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">duration</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># For now, we&#39;ll use the audio mixer or system beep</span>
        <span class="c1"># In a full implementation, this would generate actual tones</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Try to play a registered sound, or fall back to beep</span>
            <span class="n">sound_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;tone_</span><span class="si">{</span><span class="n">frequency</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">audio_mixer</span><span class="o">.</span><span class="n">play_sound</span><span class="p">(</span><span class="n">sound_name</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># Fallback: multiple beeps for different &quot;voices&quot;</span>
            <span class="n">beep_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">/</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">10</span><span class="p">)</span>
            <span class="p">)</span>  <span class="c1"># Scale duration to beep count</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">beep_count</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\a</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">duration</span> <span class="o">/</span> <span class="mi">182</span><span class="p">))</span>  <span class="c1"># Approximate timing</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Played sound: freq=</span><span class="si">{</span><span class="n">frequency</span><span class="si">}</span><span class="s2">Hz, duration=</span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2">ticks, volume=</span><span class="si">{</span><span class="n">volume</span><span class="si">}</span><span class="s2">, voice=</span><span class="si">{</span><span class="n">voice</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.draw_rectangle">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.draw_rectangle">[docs]</a>
    <span class="k">def</span> <span class="nf">draw_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw a rectangle with the given width and height&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span> <span class="o">-</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span> <span class="o">-</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span> <span class="o">+</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span> <span class="o">+</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">create_rectangle</span><span class="p">(</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pen_width</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;turtle&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.draw_dot">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.draw_dot">[docs]</a>
    <span class="k">def</span> <span class="nf">draw_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw a dot at the current turtle position&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">size</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span> <span class="o">-</span> <span class="n">radius</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span> <span class="o">-</span> <span class="n">radius</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span> <span class="o">+</span> <span class="n">radius</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span> <span class="o">+</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;turtle&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.draw_image">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.draw_image">[docs]</a>
    <span class="k">def</span> <span class="nf">draw_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw an image at the current turtle position&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageTk</span>

            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">width</span> <span class="ow">and</span> <span class="n">height</span><span class="p">:</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">width</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">height</span><span class="p">)),</span> <span class="n">Image</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span>
            <span class="n">tk_img</span> <span class="o">=</span> <span class="n">ImageTk</span><span class="o">.</span><span class="n">PhotoImage</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">create_image</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">tk_img</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;turtle&quot;</span>
            <span class="p">)</span>
            <span class="c1"># Keep reference to prevent garbage collection</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">,</span> <span class="s2">&quot;_images&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">_images</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tk_img</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading image </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.toggle_hud">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.toggle_hud">[docs]</a>
    <span class="k">def</span> <span class="nf">toggle_hud</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Toggle the HUD display&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hud_enabled</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hud_enabled</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_hud</span><span class="p">()</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.update_hud">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.update_hud">[docs]</a>
    <span class="k">def</span> <span class="nf">update_hud</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the HUD display&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;hud&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hud_enabled</span><span class="p">:</span>
            <span class="n">hud_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Pos: (</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span><span class="p">)</span><span class="si">}</span><span class="s2">) Heading: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span><span class="p">)</span><span class="si">}</span><span class="s2">°&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">create_rectangle</span><span class="p">(</span>
                <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;hud&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">create_text</span><span class="p">(</span>
                <span class="mi">15</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">hud_text</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;hud&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.take_snapshot">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.take_snapshot">[docs]</a>
    <span class="k">def</span> <span class="nf">take_snapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Take a snapshot of the graphics canvas&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">postscript</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">colormode</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Snapshot saved to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving snapshot: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.create_sprite">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.create_sprite">[docs]</a>
    <span class="k">def</span> <span class="nf">create_sprite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new sprite&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sprites</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.set_sprite_position">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.set_sprite_position">[docs]</a>
    <span class="k">def</span> <span class="nf">set_sprite_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set sprite position&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sprites</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sprites</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sprites</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.draw_sprite">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.draw_sprite">[docs]</a>
    <span class="k">def</span> <span class="nf">draw_sprite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw a sprite at its current position&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sprites</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">sprite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sprites</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_image</span><span class="p">(</span><span class="n">sprite</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

        <span class="c1"># Note: This moves the turtle to the sprite position for drawing</span>
        <span class="c1"># In a full implementation, sprites would be drawn independently</span>

<div class="viewcode-block" id="TimeWarpInterpreter.log_output">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.log_output">[docs]</a>
    <span class="k">def</span> <span class="nf">log_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log output to widget or console&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_widget</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_widget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_widget</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">tk</span><span class="o">.</span><span class="n">TclError</span><span class="p">:</span>
                <span class="c1"># Widget has been destroyed, fall back to console</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.parse_line">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.parse_line">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a program line for line number and command&quot;&quot;&quot;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^(\d+)\s+(.*)&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">line_number</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_number</span><span class="p">),</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.evaluate_expression">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.evaluate_expression">[docs]</a>
    <span class="k">def</span> <span class="nf">evaluate_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Safely evaluate mathematical expressions with variables&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">expr</span>

        <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># Reject obviously dangerous expressions</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">char</span> <span class="ow">in</span> <span class="n">expr</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;{&quot;</span><span class="p">,</span>
                <span class="s2">&quot;}&quot;</span><span class="p">,</span>
                <span class="s2">&quot;[&quot;</span><span class="p">,</span>
                <span class="s2">&quot;]&quot;</span><span class="p">,</span>
                <span class="s2">&quot;__&quot;</span><span class="p">,</span>
                <span class="s2">&quot;import&quot;</span><span class="p">,</span>
                <span class="s2">&quot;exec&quot;</span><span class="p">,</span>
                <span class="s2">&quot;eval&quot;</span><span class="p">,</span>
                <span class="s2">&quot;open&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;Expression contains forbidden characters&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expression contains forbidden characters&quot;</span><span class="p">)</span>

        <span class="c1"># Replace variables.</span>
        <span class="c1"># First substitute explicit *VAR* interpolation (used in many programs).</span>
        <span class="k">for</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">var_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">val_repr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">var_value</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val_repr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">var_value</span><span class="p">)</span>
            <span class="c1"># Replace *VAR* occurrences first</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">,</span> <span class="n">val_repr</span><span class="p">)</span>

        <span class="c1"># Then replace bare variable names using word boundaries to avoid</span>
        <span class="c1"># accidental substring replacements (e.g. A vs AB).</span>
        <span class="k">for</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">var_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">val_repr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">var_value</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val_repr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">var_value</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;\b</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span><span class="si">}</span><span class="s2">\b&quot;</span><span class="p">,</span> <span class="n">val_repr</span><span class="p">,</span> <span class="n">expr</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                <span class="c1"># fallback to plain replace if regex fails for unusual names</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">val_repr</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Allow basic math operations and functions</span>
            <span class="n">allowed_names</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;abs&quot;</span><span class="p">:</span> <span class="nb">abs</span><span class="p">,</span>
                <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">,</span>
                <span class="s2">&quot;int&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">,</span>
                <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">,</span>
                <span class="s2">&quot;len&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">,</span>
                <span class="s2">&quot;str&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="c1"># RND accepts 0 or 1 args in many example programs</span>
                <span class="s2">&quot;RND&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">a</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()),</span>
                <span class="s2">&quot;INT&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="s2">&quot;VAL&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                <span class="s2">&quot;UPPER&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                <span class="s2">&quot;LOWER&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                <span class="s2">&quot;MID&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">)]</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
                        <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="c1"># GW-BASIC Math Functions</span>
                <span class="s2">&quot;SIN&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">,</span>
                <span class="s2">&quot;COS&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">,</span>
                <span class="s2">&quot;TAN&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">,</span>
                <span class="s2">&quot;LOG&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                <span class="s2">&quot;SQR&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">,</span>
                <span class="s2">&quot;EXP&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span>
                <span class="s2">&quot;ATN&quot;</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">,</span>
                <span class="s2">&quot;SGN&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;ABS&quot;</span><span class="p">:</span> <span class="nb">abs</span><span class="p">,</span>
                <span class="c1"># GW-BASIC String Functions</span>
                <span class="s2">&quot;LEFT_DOLLAR&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)[:</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)],</span>
                <span class="s2">&quot;RIGHT_DOLLAR&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)[</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">:],</span>
                <span class="s2">&quot;MID_DOLLAR&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">:</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">)]</span>
                    <span class="k">if</span> <span class="n">length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:]</span>
                <span class="p">),</span>
                <span class="s2">&quot;INSTR&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">sub</span><span class="p">:</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sub</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="p">),</span>
                <span class="s2">&quot;LEN&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">,</span>
                <span class="s2">&quot;CHR_DOLLAR&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span>
                <span class="s2">&quot;ASC&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">ord</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;STR_DOLLAR&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>
                <span class="s2">&quot;SPACE_DOLLAR&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>
                <span class="s2">&quot;STRING_DOLLAR&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>
                <span class="c1"># TIMER function - returns seconds since midnight</span>
                <span class="s2">&quot;TIMER&quot;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">%</span> <span class="mi">86400</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="c1"># Create safe environment</span>
            <span class="n">safe_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;str&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="s2">&quot;int&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                <span class="s2">&quot;len&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">,</span>
                <span class="s2">&quot;abs&quot;</span><span class="p">:</span> <span class="nb">abs</span><span class="p">,</span>
                <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">,</span>
                <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">,</span>
                <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">safe_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">allowed_names</span><span class="p">)</span>

            <span class="c1"># Replace undefined variables with defaults</span>
            <span class="k">def</span> <span class="nf">replace_undefined_var</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># Check if it&#39;s a GW-BASIC function (with $ replaced)</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="s2">&quot;_DOLLAR&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">allowed_names</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">var</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="s2">&quot;_DOLLAR&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="k">return</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="s1">&#39;&quot;&quot;&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">var</span>

            <span class="n">expr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\b[A-Za-z_]\w*\$?\b&quot;</span><span class="p">,</span> <span class="n">replace_undefined_var</span><span class="p">,</span> <span class="n">expr</span><span class="p">)</span>
            <span class="c1"># Replace $ with _DOLLAR for function names</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="s2">&quot;_DOLLAR&quot;</span><span class="p">)</span>
            <span class="c1"># Replace custom functions</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;RND(1)&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()))</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;RND()&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()))</span>

            <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">safe_dict</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">SyntaxError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Syntax error in expression &#39;</span><span class="si">{</span><span class="n">expr</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expression error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.interpolate_text">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.interpolate_text">[docs]</a>
    <span class="k">def</span> <span class="nf">interpolate_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Interpolate *VAR* tokens and evaluate *expr* tokens inside a text string.</span>

<span class="sd">        This central helper is used by T: and MT: to keep interpolation logic</span>
<span class="sd">        consistent and reduce duplication.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># First replace explicit variable occurrences like *VAR*</span>
        <span class="k">for</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">var_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">var_value</span><span class="p">))</span>

        <span class="c1"># Then evaluate expression-like tokens remaining between *...*</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\*(.+?)\*&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
                <span class="c1"># If we&#39;ve already replaced this as a variable, skip</span>
                <span class="k">if</span> <span class="n">tok</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">tok_stripped</span> <span class="o">=</span> <span class="n">tok</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="c1"># If token looks like a numeric literal, just use it</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[-+]?\d+(?:\.\d+)?&quot;</span><span class="p">,</span> <span class="n">tok_stripped</span><span class="p">):</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*</span><span class="si">{</span><span class="n">tok</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">,</span> <span class="n">tok_stripped</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="c1"># Heuristic: if token contains expression characters, try to eval</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[\(\)\+\-\*/%&lt;&gt;=]&quot;</span><span class="p">,</span> <span class="n">tok</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;*</span><span class="si">{</span><span class="n">tok</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="c1"># leave token as-is on error</span>
                        <span class="k">pass</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">text</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.get_user_input">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.get_user_input">[docs]</a>
    <span class="k">def</span> <span class="nf">get_user_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get input from user&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_widget</span><span class="p">:</span>
            <span class="c1"># Use dialog for GUI environment</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">simpledialog</span><span class="o">.</span><span class="n">askstring</span><span class="p">(</span><span class="s2">&quot;Input&quot;</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Use console input for command line</span>
            <span class="k">return</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.execute_pilot_command">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.execute_pilot_command">[docs]</a>
    <span class="k">def</span> <span class="nf">execute_pilot_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute PILOT commands&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">command</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Determine the command prefix up to the first colon (e.g., T:, A:, MT:)</span>
            <span class="n">colon_idx</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">colon_idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">cmd_type</span> <span class="o">=</span> <span class="n">command</span><span class="p">[:</span> <span class="n">colon_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cmd_type</span> <span class="o">=</span> <span class="n">command</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">command</span>

            <span class="k">if</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;T:&quot;</span><span class="p">:</span>
                <span class="c1"># Text output</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="c1"># If the previous command set a match (Y: or N:), then this T: is</span>
                <span class="c1"># treated as conditional and only prints when match_flag is True.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_match_set</span><span class="p">:</span>
                    <span class="c1"># consume the sentinel</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_last_match_set</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_flag</span><span class="p">:</span>
                        <span class="c1"># do not print when match is false</span>
                        <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;A:&quot;</span><span class="p">:</span>
                <span class="c1"># Accept input</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Enter value for </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">: &quot;</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_input</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="c1"># Try to convert to number, otherwise keep as string</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Try int first</span>
                    <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">and</span> <span class="s2">&quot;e&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;Y:&quot;</span><span class="p">:</span>
                <span class="c1"># Match if condition is true</span>
                <span class="n">condition</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">match_flag</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">match_flag</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in Y: condition &#39;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># mark that the last command set the match flag so a following T: can be conditional</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_last_match_set</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;N:&quot;</span><span class="p">:</span>
                <span class="c1"># Match if condition is false</span>
                <span class="n">condition</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span>
                    <span class="c1"># N: treat like a plain conditional (match when the condition is TRUE).</span>
                    <span class="c1"># Many existing examples and tests use N: as an alternate test</span>
                    <span class="c1"># rather than the logical negation of Y:, so keep it as a standard</span>
                    <span class="c1"># conditional that sets the match flag to the evaluated result.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">match_flag</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># On error, default to no match</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">match_flag</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in N: condition &#39;</span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># mark that the last command set the match flag so a following T: can be conditional</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_last_match_set</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;J:&quot;</span><span class="p">:</span>
                <span class="c1"># Jump to label</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="c1"># If the previous command set a match (Y: or N:), treat this J:</span>
                <span class="c1"># as conditional: consume the sentinel and only jump when</span>
                <span class="c1"># match_flag is True. This matches examples that write</span>
                <span class="c1"># &quot;Y:cond&quot; followed by &quot;J:label&quot; as a conditional jump.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_match_set</span><span class="p">:</span>
                    <span class="c1"># consume sentinel</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_last_match_set</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_flag</span><span class="p">:</span>
                        <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
                <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;jump:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;M:&quot;</span><span class="p">:</span>
                <span class="c1"># Jump if match flag is set</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_flag</span> <span class="ow">and</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;jump:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;MT:&quot;</span><span class="p">:</span>
                <span class="c1"># Match-conditional text output: only output when match_flag is True</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_flag</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;R:&quot;</span><span class="p">:</span>
                <span class="c1"># Extended runtime commands (from templecode.py)</span>
                <span class="n">arg_upper</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">if</span> <span class="n">command</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">arg_upper</span> <span class="ow">and</span> <span class="n">arg_upper</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;SND &quot;</span><span class="p">):</span>
                    <span class="c1"># R: SND name=file.wav</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                        <span class="sa">r</span><span class="s1">&#39;name\s*=\s*&quot;([^&quot;]+)&quot;\s*,\s*file\s*=\s*&quot;([^&quot;]+)&quot;&#39;</span><span class="p">,</span>
                        <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span>
                        <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">name</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">audio_mixer</span><span class="o">.</span><span class="n">register_sound</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sound &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; registered&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                            <span class="s1">&#39;Invalid SND syntax: R: SND name=&quot;soundname&quot;, file=&quot;path.wav&quot;&#39;</span>
                        <span class="p">)</span>
                <span class="k">elif</span> <span class="n">arg_upper</span> <span class="ow">and</span> <span class="n">arg_upper</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;PLAY &quot;</span><span class="p">):</span>
                    <span class="c1"># R: PLAY &quot;soundname&quot;</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]+)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">audio_mixer</span><span class="o">.</span><span class="n">play_sound</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Playing sound &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s1">&#39;Invalid PLAY syntax: R: PLAY &quot;soundname&quot;&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">arg_upper</span> <span class="ow">and</span> <span class="n">arg_upper</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;SAVE &quot;</span><span class="p">):</span>
                    <span class="c1"># R: SAVE &quot;slotname&quot;</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]+)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">slot</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="c1"># Save current state</span>
                        <span class="kn">import</span> <span class="nn">os</span>

                        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/.time_warp_saves&quot;</span><span class="p">)</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">slot</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>
                        <span class="kn">import</span> <span class="nn">json</span>

                        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">,</span>
                            <span class="s2">&quot;turtle_x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span><span class="p">,</span>
                            <span class="s2">&quot;turtle_y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span><span class="p">,</span>
                            <span class="s2">&quot;turtle_heading&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span><span class="p">,</span>
                            <span class="s2">&quot;pen_down&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen_down</span><span class="p">,</span>
                            <span class="s2">&quot;pen_color&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span><span class="p">,</span>
                            <span class="s2">&quot;pen_width&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen_width</span><span class="p">,</span>
                        <span class="p">}</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Game saved to slot &#39;</span><span class="si">{</span><span class="n">slot</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s1">&#39;Invalid SAVE syntax: R: SAVE &quot;slotname&quot;&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">arg_upper</span> <span class="ow">and</span> <span class="n">arg_upper</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;LOAD &quot;</span><span class="p">):</span>
                    <span class="c1"># R: LOAD &quot;slotname&quot;</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">([^</span><span class="se">\&quot;</span><span class="s2">]+)</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">slot</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="kn">import</span> <span class="nn">os</span>

                        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;~/.time_warp_saves/</span><span class="si">{</span><span class="n">slot</span><span class="si">}</span><span class="s2">.json&quot;</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
                            <span class="kn">import</span> <span class="nn">json</span>

                            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                                <span class="n">state</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;variables&quot;</span><span class="p">,</span> <span class="p">{}))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;turtle_x&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;turtle_y&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;turtle_heading&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pen_down</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pen_down&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pen_color&quot;</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pen_width</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pen_width&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Game loaded from slot &#39;</span><span class="si">{</span><span class="n">slot</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Save slot &#39;</span><span class="si">{</span><span class="n">slot</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s1">&#39;Invalid LOAD syntax: R: LOAD &quot;slotname&quot;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Default: treat as gosub (subroutine call)</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
                        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;jump:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;C:&quot;</span><span class="p">:</span>
                <span class="c1"># Return from subroutine</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">:</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;jump:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;L:&quot;</span><span class="p">:</span>
                <span class="c1"># Label - do nothing</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;U:&quot;</span><span class="p">:</span>
                <span class="c1"># Update variable</span>
                <span class="n">assignment</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">assignment</span><span class="p">:</span>
                    <span class="n">var_name</span><span class="p">,</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">assignment</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">var_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="c1"># Check for quoted strings first</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span>
                        <span class="n">expr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">expr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Remove quotes</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Try to evaluate as expression</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="c1"># If evaluation fails, check if it&#39;s a security issue</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="s2">&quot;forbidden&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                                <span class="ow">or</span> <span class="s2">&quot;dangerous&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                            <span class="p">):</span>
                                <span class="c1"># Don&#39;t store dangerous expressions</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assignment rejected: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">return</span> <span class="s2">&quot;error&quot;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># For other errors, treat as literal string</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="n">expr</span>  <span class="c1"># Keep as-is</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;GAME:&quot;</span><span class="p">:</span>
                <span class="c1"># Game development commands</span>
                <span class="n">game_cmd</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>  <span class="c1"># Remove &#39;GAME:&#39;</span>

                <span class="k">if</span> <span class="n">game_cmd</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;CREATE&quot;</span><span class="p">):</span>
                    <span class="c1"># GAME:CREATE object_name type x y width height</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">game_cmd</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
                        <span class="n">obj_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">obj_type</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

                        <span class="c1"># Initialize game objects storage if needed</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;game_objects&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;game_object_count&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">game_object_count</span> <span class="o">=</span> <span class="mi">0</span>

                        <span class="c1"># Create the game object</span>
                        <span class="n">obj_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_object_count</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="p">[</span><span class="n">obj_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">obj_name</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">obj_type</span><span class="p">,</span>
                            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
                            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span>
                            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span>
                            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">height</span><span class="p">,</span>
                            <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="s2">&quot;velocity_x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s2">&quot;velocity_y&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="p">}</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">game_object_count</span> <span class="o">=</span> <span class="n">obj_id</span>

                        <span class="c1"># Set variables as expected by tests</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_OBJECT_COUNT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_object_count</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;GAME_OBJECT_</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">_NAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj_name</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;GAME_OBJECT_</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">_TYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj_type</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;GAME_OBJECT_</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">_X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;GAME_OBJECT_</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">_Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;GAME_OBJECT_</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">_WIDTH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">width</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;GAME_OBJECT_</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">_HEIGHT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">height</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;GAME_OBJECT_</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">_VISIBLE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;GAME_OBJECT_</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">_VELOCITY_X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;GAME_OBJECT_</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">_VELOCITY_Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                            <span class="s2">&quot;GAME:CREATE requires: name type x y width height&quot;</span>
                        <span class="p">)</span>
                    <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                <span class="k">elif</span> <span class="n">game_cmd</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;MOVE&quot;</span><span class="p">):</span>
                    <span class="c1"># GAME:MOVE object_name dx dy speed</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">game_cmd</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">obj_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

                        <span class="c1"># Find object by name</span>
                        <span class="n">obj_id</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">for</span> <span class="n">oid</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">obj_name</span><span class="p">:</span>
                                <span class="n">obj_id</span> <span class="o">=</span> <span class="n">oid</span>
                                <span class="k">break</span>

                        <span class="k">if</span> <span class="n">obj_id</span><span class="p">:</span>
                            <span class="c1"># Update position</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="p">[</span><span class="n">obj_id</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">speed</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="p">[</span><span class="n">obj_id</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">speed</span>

                            <span class="c1"># Update variables</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;GAME_OBJECT_</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">_X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="p">[</span><span class="n">obj_id</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;GAME_OBJECT_</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">_Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="p">[</span><span class="n">obj_id</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_LAST_MOVE_RESULT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_LAST_MOVE_RESULT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;GAME:MOVE requires: name dx dy speed&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                <span class="k">elif</span> <span class="n">game_cmd</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;PHYSICS&quot;</span><span class="p">):</span>
                    <span class="c1"># GAME:PHYSICS GRAVITY value</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">game_cmd</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;GRAVITY&quot;</span><span class="p">:</span>
                        <span class="n">gravity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_GRAVITY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gravity</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_PHYSICS_ENABLED&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;GAME:PHYSICS syntax: GRAVITY value&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                <span class="k">elif</span> <span class="n">game_cmd</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;COLLISION&quot;</span><span class="p">):</span>
                    <span class="c1"># GAME:COLLISION CHECK obj1 obj2 result_var</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">game_cmd</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CHECK&quot;</span><span class="p">:</span>
                        <span class="n">obj1_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">obj2_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">result_var</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                        <span class="c1"># Find objects</span>
                        <span class="n">obj1</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">obj2</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">for</span> <span class="n">oid</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">obj1_name</span><span class="p">:</span>
                                <span class="n">obj1</span> <span class="o">=</span> <span class="n">obj</span>
                            <span class="k">elif</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">obj2_name</span><span class="p">:</span>
                                <span class="n">obj2</span> <span class="o">=</span> <span class="n">obj</span>

                        <span class="k">if</span> <span class="n">obj1</span> <span class="ow">and</span> <span class="n">obj2</span><span class="p">:</span>
                            <span class="c1"># Simple AABB collision detection</span>
                            <span class="n">x_overlap</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">obj1</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">obj2</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">obj2</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
                                <span class="ow">and</span> <span class="n">obj1</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">obj1</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">obj2</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="n">y_overlap</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">obj1</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">obj2</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">obj2</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
                                <span class="ow">and</span> <span class="n">obj1</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">obj1</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">obj2</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="n">collision</span> <span class="o">=</span> <span class="n">x_overlap</span> <span class="ow">and</span> <span class="n">y_overlap</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">result_var</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">collision</span> <span class="k">else</span> <span class="mi">0</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_LAST_COLLISION_CHECK&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">result_var</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_LAST_COLLISION_CHECK&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                            <span class="s2">&quot;GAME:COLLISION syntax: CHECK obj1 obj2 result_var&quot;</span>
                        <span class="p">)</span>
                    <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                <span class="k">elif</span> <span class="n">game_cmd</span> <span class="o">==</span> <span class="s2">&quot;RENDER&quot;</span><span class="p">:</span>
                    <span class="c1"># GAME:RENDER - Update render state</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_RENDER_FRAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GAME_RENDER_FRAME&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_RENDER_STATUS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                <span class="k">elif</span> <span class="n">game_cmd</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;UPDATE&quot;</span><span class="p">):</span>
                    <span class="c1"># GAME:UPDATE delta_time</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">game_cmd</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">delta_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="c1"># Apply physics to all objects</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;game_objects&quot;</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">obj_id</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="c1"># Apply gravity if physics enabled</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GAME_PHYSICS_ENABLED&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                                    <span class="n">gravity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;GAME_GRAVITY&quot;</span><span class="p">,</span> <span class="mf">9.8</span><span class="p">)</span>
                                    <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;velocity_y&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">gravity</span> <span class="o">*</span> <span class="n">delta_time</span>
                                    <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;velocity_y&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta_time</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;GAME_OBJECT_</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">_Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span>
                                        <span class="sa">f</span><span class="s2">&quot;GAME_OBJECT_</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">_VELOCITY_Y&quot;</span>
                                    <span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;velocity_y&quot;</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_UPDATE_DELTA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta_time</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_UPDATE_STATUS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;GAME:UPDATE requires delta_time&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                <span class="k">elif</span> <span class="n">game_cmd</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;DELETE&quot;</span><span class="p">):</span>
                    <span class="c1"># GAME:DELETE object_name</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">game_cmd</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">obj_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="c1"># Find and remove object</span>
                        <span class="n">obj_id_to_remove</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">for</span> <span class="n">oid</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">obj_name</span><span class="p">:</span>
                                <span class="n">obj_id_to_remove</span> <span class="o">=</span> <span class="n">oid</span>
                                <span class="k">break</span>

                        <span class="k">if</span> <span class="n">obj_id_to_remove</span><span class="p">:</span>
                            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="p">[</span><span class="n">obj_id_to_remove</span><span class="p">]</span>
                            <span class="c1"># Clean up variables</span>
                            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GAME_OBJECT_</span><span class="si">{</span><span class="n">obj_id_to_remove</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">):</span>
                                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_OBJECT_COUNT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_LAST_DELETE_RESULT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_LAST_DELETE_RESULT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;GAME:DELETE requires object_name&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                <span class="k">elif</span> <span class="n">game_cmd</span> <span class="o">==</span> <span class="s2">&quot;LIST&quot;</span><span class="p">:</span>
                    <span class="c1"># GAME:LIST - List all objects</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;game_objects&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="p">:</span>
                        <span class="n">obj_list</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">obj_id</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">obj_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_OBJECT_LIST&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obj_list</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_OBJECT_COUNT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_OBJECT_LIST&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_OBJECT_COUNT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                <span class="k">elif</span> <span class="n">game_cmd</span> <span class="o">==</span> <span class="s2">&quot;CLEAR&quot;</span><span class="p">:</span>
                    <span class="c1"># GAME:CLEAR - Clear all game objects</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;game_objects&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                    <span class="c1"># Clean up all game variables</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;GAME_&quot;</span><span class="p">):</span>
                            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_OBJECT_COUNT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_CLEAR_STATUS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                <span class="k">elif</span> <span class="n">game_cmd</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
                    <span class="c1"># GAME:INFO object_name [variable_name]</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">game_cmd</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">obj_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">var_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;GAME_OBJECT_INFO&quot;</span>
                        <span class="c1"># Find object</span>
                        <span class="n">obj_info</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">for</span> <span class="n">oid</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_objects</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">obj_name</span><span class="p">:</span>
                                <span class="n">obj_info</span> <span class="o">=</span> <span class="n">obj</span>
                                <span class="n">obj_id</span> <span class="o">=</span> <span class="n">oid</span>
                                <span class="k">break</span>

                        <span class="k">if</span> <span class="n">obj_info</span><span class="p">:</span>
                            <span class="n">info_str</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obj_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">obj_id</span><span class="si">}</span><span class="s2">): &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;pos(</span><span class="si">{</span><span class="n">obj_info</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">obj_info</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">) &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;size(</span><span class="si">{</span><span class="n">obj_info</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">obj_info</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">) &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;type(</span><span class="si">{</span><span class="n">obj_info</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">) &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;visible(</span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">obj_info</span><span class="p">[</span><span class="s1">&#39;visible&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mi">0</span><span class="si">}</span><span class="s2">)&quot;</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">info_str</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_INFO_FOUND&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;OBJECT_NOT_FOUND&quot;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_INFO_FOUND&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;GAME:INFO requires object_name&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                <span class="k">elif</span> <span class="n">game_cmd</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;DEMO&quot;</span><span class="p">):</span>
                    <span class="c1"># GAME:DEMO demo_type</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">game_cmd</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">demo_type</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_DEMO_TYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">demo_type</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_DEMO_STATUS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="c1"># Create demo objects based on type</span>
                        <span class="k">if</span> <span class="n">demo_type</span> <span class="o">==</span> <span class="s2">&quot;pong&quot;</span><span class="p">:</span>
                            <span class="c1"># Create paddle and ball for pong demo</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_DEMO_PADDLE_Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_DEMO_BALL_X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_DEMO_BALL_Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_DEMO_SCORE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">elif</span> <span class="n">demo_type</span> <span class="o">==</span> <span class="s2">&quot;platformer&quot;</span><span class="p">:</span>
                            <span class="c1"># Create player and platforms</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_DEMO_PLAYER_X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_DEMO_PLAYER_Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;GAME_DEMO_LEVEL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;GAME:DEMO requires demo_type&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown GAME command: </span><span class="si">{</span><span class="n">game_cmd</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;END&quot;</span><span class="p">:</span>
                <span class="c1"># End program</span>
                <span class="k">return</span> <span class="s2">&quot;end&quot;</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PILOT command error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

        <span class="k">return</span> <span class="s2">&quot;continue&quot;</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.execute_basic_command">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.execute_basic_command">[docs]</a>
    <span class="k">def</span> <span class="nf">execute_basic_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute BASIC-like commands&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">command</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="n">cmd</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;LET&quot;</span><span class="p">:</span>
                <span class="c1"># Variable assignment</span>
                <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">command</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">assignment</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">assignment</span><span class="p">:</span>
                        <span class="n">var_name</span><span class="p">,</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">assignment</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">var_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in LET </span><span class="si">{</span><span class="n">assignment</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;IF&quot;</span><span class="p">:</span>
                <span class="c1"># IF condition THEN command  - evaluate condition, execute then-part if true</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;IF\s+(.+?)\s+THEN\s+(.+)&quot;</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">cond_expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">then_cmd</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">cond_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">cond_expr</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="n">cond_val</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">if</span> <span class="n">cond_val</span><span class="p">:</span>
                            <span class="c1"># Execute the THEN command using the general line executor so</span>
                            <span class="c1"># it can be a BASIC, PILOT or LOGO command fragment.</span>
                            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_line</span><span class="p">(</span><span class="n">then_cmd</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;IF statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;FOR&quot;</span><span class="p">:</span>
                <span class="c1"># FOR var = start TO end [STEP step]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
                        <span class="sa">r</span><span class="s2">&quot;FOR\s+([A-Za-z_]\w*)\s*=\s*(.+?)\s+TO\s+(.+?)(?:\s+STEP\s+(.+))?$&quot;</span><span class="p">,</span>
                        <span class="n">command</span><span class="p">,</span>
                        <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                        <span class="n">var_name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">start_expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">end_expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">step_expr</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

                        <span class="n">start_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">start_expr</span><span class="p">)</span>
                        <span class="n">end_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">end_expr</span><span class="p">)</span>
                        <span class="n">step_val</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">step_expr</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">step_expr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                            <span class="k">else</span> <span class="mi">1</span>
                        <span class="p">)</span>

                        <span class="c1"># Integer-only loops: coerce start/end/step to int</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">start_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start_val</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="n">start_val</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">end_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">end_val</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="n">end_val</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">step_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">step_val</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="n">step_val</span> <span class="o">=</span> <span class="mi">1</span>

                        <span class="c1"># Store the loop variable and position</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_val</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">for_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;var&quot;</span><span class="p">:</span> <span class="n">var_name</span><span class="p">,</span>
                                <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">end_val</span><span class="p">,</span>
                                <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step_val</span><span class="p">,</span>
                                <span class="s2">&quot;for_line&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span><span class="p">,</span>
                            <span class="p">}</span>
                        <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FOR statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;PRINT&quot;</span><span class="p">:</span>
                <span class="c1"># Print output</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
                <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
                    <span class="n">part</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">part</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">):</span>
                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
                            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;REM&quot;</span><span class="p">:</span>
                <span class="c1"># Comment - ignore rest of the line</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;END&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;end&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;INPUT&quot;</span><span class="p">:</span>
                <span class="c1"># Get user input</span>
                <span class="c1"># Parse INPUT [prompt;] var</span>
                <span class="n">input_part</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># remove &#39;INPUT&#39;</span>
                <span class="k">if</span> <span class="s2">&quot;;&quot;</span> <span class="ow">in</span> <span class="n">input_part</span><span class="p">:</span>
                    <span class="n">prompt_part</span><span class="p">,</span> <span class="n">var_part</span> <span class="o">=</span> <span class="n">input_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt_part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
                    <span class="n">var_name</span> <span class="o">=</span> <span class="n">var_part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">var_name</span> <span class="o">=</span> <span class="n">input_part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Enter value for </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">: &quot;</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_input</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="c1"># Try to convert to number, otherwise keep as string</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Try int first</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Try float</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="c1"># Keep as string</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;GOTO&quot;</span><span class="p">:</span>
                <span class="c1"># Jump to line number</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">line_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="n">line_num</span><span class="p">:</span>
                            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;jump:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;GOSUB&quot;</span><span class="p">:</span>
                <span class="c1"># Push return address and jump to line number</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">line_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="c1"># push next-line index</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="n">line_num</span><span class="p">:</span>
                            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;jump:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;RETURN&quot;</span><span class="p">:</span>
                <span class="c1"># Return from GOSUB</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">:</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;jump:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;NEXT&quot;</span><span class="p">:</span>
                <span class="c1"># NEXT [var]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">var_spec</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>

                    <span class="c1"># Find matching FOR on the stack</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_stack</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;NEXT without FOR&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                    <span class="c1"># If var specified, search from top for match, else take top</span>
                    <span class="k">if</span> <span class="n">var_spec</span><span class="p">:</span>
                        <span class="c1"># strip possible commas</span>
                        <span class="n">var_spec</span> <span class="o">=</span> <span class="n">var_spec</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">found_idx</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_stack</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_stack</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;var&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">var_spec</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                                <span class="n">found_idx</span> <span class="o">=</span> <span class="n">i</span>
                                <span class="k">break</span>
                        <span class="k">if</span> <span class="n">found_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NEXT for unknown variable </span><span class="si">{</span><span class="n">var_spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
                        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_stack</span><span class="p">[</span><span class="n">found_idx</span><span class="p">]</span>
                        <span class="c1"># remove any inner loops above this one? keep nested intact</span>
                        <span class="c1"># Only pop if loop finishes</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">found_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">for_stack</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

                    <span class="n">var_name</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;var&quot;</span><span class="p">]</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">])</span>
                    <span class="n">end_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">])</span>

                    <span class="c1"># Ensure variable exists (treat as integer)</span>
                    <span class="n">current_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">current_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">current_val</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">current_val</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="n">next_val</span> <span class="o">=</span> <span class="n">current_val</span> <span class="o">+</span> <span class="n">step</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">next_val</span><span class="p">)</span>

                    <span class="c1"># Decide whether to loop</span>
                    <span class="n">loop_again</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">loop_again</span> <span class="o">=</span> <span class="n">next_val</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">end_val</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">loop_again</span> <span class="o">=</span> <span class="n">next_val</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">end_val</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">loop_again</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">if</span> <span class="n">loop_again</span><span class="p">:</span>
                        <span class="c1"># jump to line after FOR statement</span>
                        <span class="n">for_line</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">[</span><span class="s2">&quot;for_line&quot;</span><span class="p">]</span>
                        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;jump:</span><span class="si">{</span><span class="n">for_line</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># pop this FOR from stack</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">for_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">found_idx</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="k">pass</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NEXT statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="c1"># GW-BASIC Graphics Commands</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;SCREEN&quot;</span><span class="p">:</span>
                <span class="c1"># SCREEN [mode] [, [burst] [, [active_page] [, visible_page]]]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;SCREEN&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="c1"># Parse arguments separated by commas</span>
                        <span class="n">screen_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
                        <span class="n">mode</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">screen_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                            <span class="k">if</span> <span class="n">screen_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">else</span> <span class="mi">0</span>
                        <span class="p">)</span>

                        <span class="c1"># For now, we support basic screen modes</span>
                        <span class="c1"># Mode 0: Text mode (default)</span>
                        <span class="c1"># Mode 1-7: Graphics modes (we&#39;ll treat them as graphics enabled)</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="c1"># Text mode - could disable graphics if needed</span>
                            <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># Graphics mode - ensure graphics are enabled</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                                    <span class="s2">&quot;Graphics not available in this environment&quot;</span>
                                <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Default screen mode</span>
                        <span class="k">pass</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SCREEN statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;COLOR&quot;</span><span class="p">:</span>
                <span class="c1"># COLOR [foreground] [, background]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;COLOR&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">color_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">color_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">fg_color</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">color_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">fg_color</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color_args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">color_args</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">bg_color</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">color_args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                            <span class="c1"># Set background color if canvas available</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
                                <span class="n">bg_hex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">bg_color</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)]</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="n">bg_hex</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;COLOR statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;PALETTE&quot;</span><span class="p">:</span>
                <span class="c1"># PALETTE [attribute, color]</span>
                <span class="c1"># For simplicity, we&#39;ll just log this for now</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;PALETTE&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">palette_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">palette_args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">attr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">palette_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                            <span class="n">color</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">palette_args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Palette attribute </span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2"> set to color </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PALETTE statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;PSET&quot;</span><span class="p">:</span>
                <span class="c1"># PSET [STEP] (x, y) [, color]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;PSET&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="c1"># Parse STEP option and coordinates</span>
                        <span class="n">step_mode</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;STEP&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">step_mode</span><span class="p">:</span>
                            <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;STEP&#39;</span>

                        <span class="c1"># Extract coordinates and optional color</span>
                        <span class="n">coord_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(\s*([^,]+)\s*,\s*([^)]+)\)&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">coord_match</span><span class="p">:</span>
                            <span class="n">x_expr</span> <span class="o">=</span> <span class="n">coord_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">y_expr</span> <span class="o">=</span> <span class="n">coord_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">x_expr</span><span class="p">)</span>
                            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">y_expr</span><span class="p">)</span>

                            <span class="c1"># Check for optional color</span>
                            <span class="n">remaining</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">coord_match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span> <span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">color</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">if</span> <span class="n">remaining</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
                                <span class="n">color_expr</span> <span class="o">=</span> <span class="n">remaining</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                                <span class="n">color</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">color_expr</span><span class="p">))</span>
                                <span class="n">color_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">color</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">color_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span>

                            <span class="k">if</span> <span class="n">step_mode</span><span class="p">:</span>
                                <span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span>
                                <span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span>

                            <span class="c1"># Draw point</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
                                <span class="n">canvas_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">+</span> <span class="n">x</span>
                                <span class="n">canvas_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">-</span> <span class="n">y</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span>
                                    <span class="n">canvas_x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="n">canvas_y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="n">canvas_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="n">canvas_y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="n">fill</span><span class="o">=</span><span class="n">color_name</span><span class="p">,</span>
                                    <span class="n">outline</span><span class="o">=</span><span class="n">color_name</span><span class="p">,</span>
                                    <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;graphics&quot;</span><span class="p">,</span>
                                <span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PSET statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;PRESET&quot;</span><span class="p">:</span>
                <span class="c1"># PRESET [STEP] (x, y) [, color]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;PRESET&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="c1"># Parse STEP option and coordinates</span>
                        <span class="n">step_mode</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;STEP&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">step_mode</span><span class="p">:</span>
                            <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;STEP&#39;</span>

                        <span class="c1"># Extract coordinates and optional color</span>
                        <span class="n">coord_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(\s*([^,]+)\s*,\s*([^)]+)\)&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">coord_match</span><span class="p">:</span>
                            <span class="n">x_expr</span> <span class="o">=</span> <span class="n">coord_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">y_expr</span> <span class="o">=</span> <span class="n">coord_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">x_expr</span><span class="p">)</span>
                            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">y_expr</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">step_mode</span><span class="p">:</span>
                                <span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span>
                                <span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span>

                            <span class="c1"># Erase point (draw background color)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
                                <span class="n">canvas_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">+</span> <span class="n">x</span>
                                <span class="n">canvas_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">-</span> <span class="n">y</span>
                                <span class="n">bg_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s2">&quot;bg&quot;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span>
                                    <span class="n">canvas_x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="n">canvas_y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="n">canvas_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="n">canvas_y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="n">fill</span><span class="o">=</span><span class="n">bg_color</span><span class="p">,</span>
                                    <span class="n">outline</span><span class="o">=</span><span class="n">bg_color</span><span class="p">,</span>
                                    <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;graphics&quot;</span><span class="p">,</span>
                                <span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PRESET statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;CIRCLE&quot;</span><span class="p">:</span>
                <span class="c1"># CIRCLE [STEP] (x, y), radius [, [color] [, [start] [, [end] [, aspect]]]]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;CIRCLE&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="c1"># Parse STEP option</span>
                        <span class="n">step_mode</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;STEP&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">step_mode</span><span class="p">:</span>
                            <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;STEP&#39;</span>

                        <span class="c1"># Parse the complex CIRCLE syntax</span>
                        <span class="c1"># Format: (x, y), radius [, color [, start [, end [, aspect]]]]</span>
                        <span class="n">parts</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">coord_part</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">radius_part</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                            <span class="c1"># Extract coordinates</span>
                            <span class="n">coord_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                                <span class="sa">r</span><span class="s2">&quot;\(\s*([^,]+)\s*,\s*([^)]+)\)&quot;</span><span class="p">,</span> <span class="n">coord_part</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">coord_match</span><span class="p">:</span>
                                <span class="n">x_expr</span> <span class="o">=</span> <span class="n">coord_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                                <span class="n">y_expr</span> <span class="o">=</span> <span class="n">coord_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">x_expr</span><span class="p">)</span>
                                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">y_expr</span><span class="p">)</span>

                                <span class="k">if</span> <span class="n">step_mode</span><span class="p">:</span>
                                    <span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span>
                                    <span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span>

                                <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">radius_part</span><span class="p">)</span>

                                <span class="c1"># Optional parameters</span>
                                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span>
                                <span class="n">start_angle</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="n">end_angle</span> <span class="o">=</span> <span class="mi">360</span>
                                <span class="n">aspect</span> <span class="o">=</span> <span class="mf">1.0</span>

                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                                    <span class="n">color_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span>
                                        <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                                    <span class="p">)</span>
                                    <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span>
                                        <span class="nb">int</span><span class="p">(</span><span class="n">color_val</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
                                    <span class="p">]</span>

                                <span class="c1"># Draw circle</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">draw_circle_at</span><span class="p">(</span>
                                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">start_angle</span><span class="p">,</span> <span class="n">end_angle</span><span class="p">,</span> <span class="n">aspect</span>
                                <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CIRCLE statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;DRAW&quot;</span><span class="p">:</span>
                <span class="c1"># DRAW string_expression</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;DRAW&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">):</span>
                        <span class="n">draw_string</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">execute_draw_commands</span><span class="p">(</span><span class="n">draw_string</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DRAW statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;PAINT&quot;</span><span class="p">:</span>
                <span class="c1"># PAINT [STEP] (x, y) [, [paint_color] [, [border_color] [, background]]]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;PAINT&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="c1"># Parse STEP option</span>
                        <span class="n">step_mode</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;STEP&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">step_mode</span><span class="p">:</span>
                            <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;STEP&#39;</span>

                        <span class="c1"># Parse coordinates</span>
                        <span class="n">coord_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(\s*([^,]+)\s*,\s*([^)]+)\)&quot;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">coord_match</span><span class="p">:</span>
                            <span class="n">x_expr</span> <span class="o">=</span> <span class="n">coord_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">y_expr</span> <span class="o">=</span> <span class="n">coord_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">x_expr</span><span class="p">)</span>
                            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">y_expr</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">step_mode</span><span class="p">:</span>
                                <span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span>
                                <span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span>

                            <span class="c1"># Optional paint color</span>
                            <span class="n">paint_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span>
                            <span class="n">remaining</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">coord_match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span> <span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">remaining</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
                                <span class="n">color_part</span> <span class="o">=</span> <span class="n">remaining</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                                <span class="k">if</span> <span class="n">color_part</span><span class="p">:</span>
                                    <span class="n">color_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">color_part</span><span class="p">)</span>
                                    <span class="p">)</span>
                                    <span class="n">paint_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span>
                                        <span class="n">color_val</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
                                    <span class="p">]</span>

                            <span class="c1"># Fill area (simplified implementation)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
                                <span class="n">canvas_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">+</span> <span class="n">x</span>
                                <span class="n">canvas_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">-</span> <span class="n">y</span>
                                <span class="c1"># For simplicity, we&#39;ll just draw a filled circle at the point</span>
                                <span class="c1"># A full implementation would do flood fill</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">create_oval</span><span class="p">(</span>
                                    <span class="n">canvas_x</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span>
                                    <span class="n">canvas_y</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span>
                                    <span class="n">canvas_x</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span>
                                    <span class="n">canvas_y</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span>
                                    <span class="n">fill</span><span class="o">=</span><span class="n">paint_color</span><span class="p">,</span>
                                    <span class="n">outline</span><span class="o">=</span><span class="n">paint_color</span><span class="p">,</span>
                                    <span class="n">tags</span><span class="o">=</span><span class="s2">&quot;graphics&quot;</span><span class="p">,</span>
                                <span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PAINT statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="c1"># GW-BASIC Sound and Music Commands</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;PLAY&quot;</span><span class="p">:</span>
                <span class="c1"># PLAY string_expression</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;PLAY&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">):</span>
                        <span class="n">music_string</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">play_music_string</span><span class="p">(</span><span class="n">music_string</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PLAY statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;SOUND&quot;</span><span class="p">:</span>
                <span class="c1"># SOUND frequency, duration [, volume [, voice]]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;SOUND&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">sound_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">arg</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sound_args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">sound_args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">sound_args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="n">volume</span> <span class="o">=</span> <span class="mi">255</span>  <span class="c1"># Default maximum volume</span>
                            <span class="n">voice</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Default voice</span>

                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sound_args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                                <span class="n">volume</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">sound_args</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sound_args</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                                <span class="n">voice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">sound_args</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">play_sound</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">voice</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SOUND statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;BEEP&quot;</span><span class="p">:</span>
                <span class="c1"># BEEP - Simple beep sound</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">audio_mixer</span><span class="o">.</span><span class="n">play_sound</span><span class="p">(</span><span class="s2">&quot;beep&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># Fallback to system beep</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\a</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="c1"># Placeholder implementations for missing GW-BASIC features</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;OBJECT&quot;</span><span class="p">:</span>
                <span class="c1"># OBJECT.ADD object_name, x, y, width, height - Create graphics object</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;OBJECT&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.ADD&quot;</span><span class="p">):</span>
                        <span class="n">params</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                            <span class="n">obj_name</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
                            <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
                            <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
                            <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>

                            <span class="c1"># Create object (simplified - just store in dictionary)</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;objects&quot;</span><span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">obj_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
                                <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span>
                                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span>
                                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">height</span><span class="p">,</span>
                                <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="p">}</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Created object &#39;</span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2">&#39; at (</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">) size </span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                                <span class="s2">&quot;OBJECT.ADD requires name, x, y, width, height&quot;</span>
                            <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                            <span class="s2">&quot;OBJECT syntax: OBJECT.ADD name, x, y, width, height&quot;</span>
                        <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OBJECT statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;DEF&quot;</span><span class="p">:</span>
                <span class="c1"># DEF FNname(params) = expression - Define user function</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;DEF&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;FN&quot;</span><span class="p">):</span>
                        <span class="c1"># Parse function definition: FNname(params) = expression</span>
                        <span class="n">fn_part</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>  <span class="c1"># Remove &#39;FN&#39;</span>
                        <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">fn_part</span><span class="p">:</span>
                            <span class="n">name_expr</span><span class="p">,</span> <span class="n">expression</span> <span class="o">=</span> <span class="n">fn_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="n">name_expr</span> <span class="o">=</span> <span class="n">name_expr</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                            <span class="c1"># Extract function name and parameters</span>
                            <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">name_expr</span> <span class="ow">and</span> <span class="n">name_expr</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">):</span>
                                <span class="n">func_name</span> <span class="o">=</span> <span class="n">name_expr</span><span class="p">[:</span> <span class="n">name_expr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                                <span class="n">params_str</span> <span class="o">=</span> <span class="n">name_expr</span><span class="p">[</span><span class="n">name_expr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                                <span class="c1"># Store function definition</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;user_functions&quot;</span><span class="p">):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">user_functions</span> <span class="o">=</span> <span class="p">{}</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">user_functions</span><span class="p">[</span><span class="n">func_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                                    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">(</span>
                                        <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
                                        <span class="k">if</span> <span class="n">params_str</span>
                                        <span class="k">else</span> <span class="p">[]</span>
                                    <span class="p">),</span>
                                    <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="n">expression</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                                <span class="p">}</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Defined function </span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                                    <span class="s2">&quot;DEF FN syntax: DEF FNname(params) = expression&quot;</span>
                                <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;DEF FN requires = expression&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;DEF syntax: DEF FNname(params) = expression&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEF statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;ACTIVATE&quot;</span><span class="p">:</span>
                <span class="c1"># ACTIVATE object_name - Make object active/visible</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">8</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;ACTIVATE&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">obj_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;objects&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">obj_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">obj_name</span><span class="p">][</span><span class="s2">&quot;visible&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Activated object &#39;</span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object &#39;</span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;ACTIVATE requires object name&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ACTIVATE statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;ON&quot;</span><span class="p">:</span>
                <span class="c1"># ON event GOSUB line - Event trapping (simplified)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;ON&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">parts</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;GOSUB&quot;</span><span class="p">:</span>
                            <span class="n">event</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                            <span class="n">line_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

                            <span class="c1"># Store event handler (simplified)</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;event_handlers&quot;</span><span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">event_handlers</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">event_handlers</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_num</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Set </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2"> event handler to line </span><span class="si">{</span><span class="n">line_num</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;ON syntax: ON event GOSUB line_number&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;ON requires event and GOSUB line&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ON statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;OPEN&quot;</span><span class="p">:</span>
                <span class="c1"># OPEN file_path FOR mode AS #file_number</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;OPEN&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="c1"># Parse OPEN syntax: &quot;filename&quot; FOR mode AS #number</span>
                        <span class="n">parts</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                            <span class="n">filename_part</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
                            <span class="n">mode</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>  <span class="c1"># INPUT/OUTPUT/APPEND</span>
                            <span class="n">file_num_part</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

                            <span class="k">if</span> <span class="n">file_num_part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
                                <span class="n">file_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_num_part</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">file_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_num_part</span><span class="p">)</span>

                            <span class="c1"># Open the file</span>
                            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;INPUT&quot;</span><span class="p">:</span>
                                <span class="n">file_obj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_part</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;OUTPUT&quot;</span><span class="p">:</span>
                                <span class="n">file_obj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_part</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;APPEND&quot;</span><span class="p">:</span>
                                <span class="n">file_obj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_part</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported file mode: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                            <span class="c1"># Store file handle</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;open_files&quot;</span><span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span> <span class="o">=</span> <span class="p">{}</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="p">[</span><span class="n">file_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_obj</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Opened file &#39;</span><span class="si">{</span><span class="n">filename_part</span><span class="si">}</span><span class="s2">&#39; as #</span><span class="si">{</span><span class="n">file_num</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                                <span class="s1">&#39;OPEN syntax: OPEN &quot;filename&quot; FOR mode AS #number&#39;</span>
                            <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;OPEN requires filename, mode, and file number&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OPEN statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;CLOSE&quot;</span><span class="p">:</span>
                <span class="c1"># CLOSE [#file_number] or CLOSE</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;CLOSE&#39;</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;open_files&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                            <span class="c1"># Close specific file</span>
                            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
                                <span class="n">file_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">file_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">file_num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="p">[</span><span class="n">file_num</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="p">[</span><span class="n">file_num</span><span class="p">]</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Closed file #</span><span class="si">{</span><span class="n">file_num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File #</span><span class="si">{</span><span class="n">file_num</span><span class="si">}</span><span class="s2"> not open&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># Close all files</span>
                            <span class="k">for</span> <span class="n">file_num</span><span class="p">,</span> <span class="n">file_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="n">file_obj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;Closed all open files&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;No files currently open&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CLOSE statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
                <span class="c1"># GET #file_number, variable</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;GET&#39;</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;open_files&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">parts</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">file_num_part</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">var_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                            <span class="k">if</span> <span class="n">file_num_part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
                                <span class="n">file_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_num_part</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">file_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_num_part</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">file_num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="p">:</span>
                                <span class="n">file_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="p">[</span><span class="n">file_num</span><span class="p">]</span>
                                <span class="n">line</span> <span class="o">=</span> <span class="n">file_obj</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                                <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                                    <span class="c1"># Remove newline and store</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\r</span><span class="s2">&quot;</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                                        <span class="sa">f</span><span class="s2">&quot;Read from file #</span><span class="si">{</span><span class="n">file_num</span><span class="si">}</span><span class="s2"> into </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span>
                                    <span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># EOF</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;End of file #</span><span class="si">{</span><span class="n">file_num</span><span class="si">}</span><span class="s2"> reached&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File #</span><span class="si">{</span><span class="n">file_num</span><span class="si">}</span><span class="s2"> not open&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;GET syntax: GET #number, variable&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;No files open or invalid GET syntax&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GET statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;PUT&quot;</span><span class="p">:</span>
                <span class="c1"># PUT #file_number, expression</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;PUT&#39;</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;open_files&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">parts</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">file_num_part</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="n">expr</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                            <span class="k">if</span> <span class="n">file_num_part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
                                <span class="n">file_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_num_part</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">file_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_num_part</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">file_num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="p">:</span>
                                <span class="n">file_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span><span class="p">[</span><span class="n">file_num</span><span class="p">]</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
                                <span class="n">file_obj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="n">file_obj</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>  <span class="c1"># Ensure it&#39;s written</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrote to file #</span><span class="si">{</span><span class="n">file_num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File #</span><span class="si">{</span><span class="n">file_num</span><span class="si">}</span><span class="s2"> not open&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;PUT syntax: PUT #number, expression&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;No files open or invalid PUT syntax&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PUT statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;BLOAD&quot;</span><span class="p">:</span>
                <span class="c1"># BLOAD file_path, offset</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;BLOAD&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">parts</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
                        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>

                        <span class="c1"># Read binary file</span>
                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                        <span class="c1"># Store in memory (simplified - just log for now)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;binary_data&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">binary_data</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">binary_data</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2"> bytes from &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; at offset </span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s1">&#39;BLOAD syntax: BLOAD &quot;filename&quot; [, offset]&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BLOAD statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;BSAVE&quot;</span><span class="p">:</span>
                <span class="c1"># BSAVE file_path, offset, length</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;BSAVE&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">parts</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">filename</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
                            <span class="n">offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
                            <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>

                            <span class="c1"># Get data from memory</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;binary_data&quot;</span><span class="p">)</span>
                                <span class="ow">and</span> <span class="n">offset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_data</span>
                            <span class="p">):</span>
                                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_data</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">length</span><span class="p">]</span>

                                <span class="c1"># Write binary file</span>
                                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;Saved </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2"> bytes to &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
                                <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No data available at offset </span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                                <span class="s1">&#39;BSAVE syntax: BSAVE &quot;filename&quot;, offset, length&#39;</span>
                            <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;BSAVE requires filename, offset, and length&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BSAVE statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;CHAIN&quot;</span><span class="p">:</span>
                <span class="c1"># CHAIN filename - Load and run another BASIC program</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;CHAIN&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;CHAIN to &#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; (simplified - would load and run new program)&quot;</span>
                        <span class="p">)</span>
                        <span class="c1"># In a real implementation, this would:</span>
                        <span class="c1"># 1. Save current COMMON variables</span>
                        <span class="c1"># 2. Load the new program</span>
                        <span class="c1"># 3. Transfer COMMON variables</span>
                        <span class="c1"># 4. Execute the new program</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;CHAIN requires a filename&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CHAIN statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;COMMON&quot;</span><span class="p">:</span>
                <span class="c1"># COMMON var1, var2, ... - Mark variables to be shared with CHAINed programs</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;COMMON&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">var_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;common_vars&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">common_vars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">common_vars</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">var_names</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Marked variables as COMMON: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">var_names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;COMMON requires variable names&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;COMMON statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;ERASE&quot;</span><span class="p">:</span>
                <span class="c1"># ERASE array1, array2, ... - Delete array variables</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;ERASE&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">array_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
                        <span class="n">erased</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">array_name</span> <span class="ow">in</span> <span class="n">array_names</span><span class="p">:</span>
                            <span class="c1"># Remove array variables (variables ending with ())</span>
                            <span class="n">array_vars</span> <span class="o">=</span> <span class="p">[</span>
                                <span class="n">k</span>
                                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">array_name</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span><span class="p">)</span>
                            <span class="p">]</span>
                            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">array_vars</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
                                    <span class="n">erased</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">erased</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Erased arrays: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">erased</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;No matching arrays found to erase&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;ERASE requires array names&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERASE statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;RANDOMIZE&quot;</span><span class="p">:</span>
                <span class="c1"># RANDOMIZE [seed] - Seed the random number generator</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;RANDOMIZE&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
                        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Random seed set to </span><span class="si">{</span><span class="n">seed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Use current time as seed</span>
                        <span class="kn">import</span> <span class="nn">time</span>

                        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;Random seed set to current time&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RANDOMIZE statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;SWAP&quot;</span><span class="p">:</span>
                <span class="c1"># SWAP var1, var2 - Exchange values of two variables</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;SWAP&#39;</span>
                    <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
                        <span class="k">if</span> <span class="n">var1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="ow">and</span> <span class="n">var2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                            <span class="c1"># Swap the values</span>
                            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var1</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var2</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var2</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Swapped </span><span class="si">{</span><span class="n">var1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">var2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variables </span><span class="si">{</span><span class="n">var1</span><span class="si">}</span><span class="s2"> and/or </span><span class="si">{</span><span class="n">var2</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                            <span class="s2">&quot;SWAP requires two variables separated by comma&quot;</span>
                        <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SWAP statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;CALL&quot;</span><span class="p">:</span>
                <span class="c1"># Placeholder for CALL assembly</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;Assembly integration not implemented yet&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;USR&quot;</span><span class="p">:</span>
                <span class="c1"># Placeholder for USR function</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;Assembly integration not implemented yet&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;PEEK&quot;</span><span class="p">:</span>
                <span class="c1"># PEEK(address) - Read byte from memory address</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;PEEK&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">):</span>
                        <span class="n">address_expr</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">address_expr</span><span class="p">))</span>

                        <span class="c1"># Simulate memory access (simplified - return 0 for now)</span>
                        <span class="c1"># In a real implementation, this would access actual memory</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Placeholder for memory read</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PEEK(</span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">) returned </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;PEEK syntax: PEEK(address)&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PEEK function error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;0&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;POKE&quot;</span><span class="p">:</span>
                <span class="c1"># POKE address, value - Write byte to memory address</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;POKE&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">parts</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>

                            <span class="c1"># Simulate memory write (simplified - just log)</span>
                            <span class="c1"># In a real implementation, this would write to actual memory</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;POKE </span><span class="si">{</span><span class="n">address</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;POKE syntax: POKE address, value&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;POKE requires address and value&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;POKE statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;WAIT&quot;</span><span class="p">:</span>
                <span class="c1"># WAIT seconds - Pause execution for specified seconds</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;WAIT&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">seconds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
                        <span class="kn">import</span> <span class="nn">time</span>

                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">seconds</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Waited </span><span class="si">{</span><span class="n">seconds</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;WAIT requires seconds value&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WAIT statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;INKEY$&quot;</span><span class="p">:</span>
                <span class="c1"># INKEY$ - Return pressed key or empty string</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Simulate by prompting for input</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Press a key: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;INKEY$&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># First char only</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;INKEY$&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INKEY$ returned: &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;INKEY$&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INKEY$ error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;INKEY$&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;STICK&quot;</span><span class="p">:</span>
                <span class="c1"># STICK(axis) - Read joystick position (-1 to 1)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;STICK&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">):</span>
                        <span class="n">axis_expr</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">axis</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">axis_expr</span><span class="p">))</span>

                        <span class="c1"># Simulate joystick input (simplified - return 0 for now)</span>
                        <span class="c1"># In a real implementation, this would read from actual joystick</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># Placeholder for joystick axis</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;STICK(</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2">) returned </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;STICK syntax: STICK(axis)&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;STICK function error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;0&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;STRIG&quot;</span><span class="p">:</span>
                <span class="c1"># STRIG(button) - Read joystick button state (0 or -1)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;STRIG&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">):</span>
                        <span class="n">button_expr</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">button</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">button_expr</span><span class="p">))</span>

                        <span class="c1"># Simulate joystick button (simplified - return 0 for now)</span>
                        <span class="c1"># In a real implementation, this would read from actual joystick</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Placeholder for button state (0=not pressed, -1=pressed)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;STRIG(</span><span class="si">{</span><span class="n">button</span><span class="si">}</span><span class="s2">) returned </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;STRIG syntax: STRIG(button)&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;STRIG function error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;0&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;NEW&quot;</span><span class="p">:</span>
                <span class="c1"># NEW - Clear current program and reset interpreter state</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Save current state for potential OLD command</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;saved_state&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">saved_state</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="c1"># Save current state before clearing</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">saved_state</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="s2">&quot;procedures&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">procedures</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="s2">&quot;program_lines&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="s2">&quot;current_line&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span><span class="p">,</span>
                        <span class="s2">&quot;stack&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="s2">&quot;for_stack&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">for_stack</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="s2">&quot;match_flag&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_flag</span><span class="p">,</span>
                        <span class="s2">&quot;_last_match_set&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_match_set</span><span class="p">,</span>
                        <span class="s2">&quot;running&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">,</span>
                        <span class="s2">&quot;turtle_x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span><span class="p">,</span>
                        <span class="s2">&quot;turtle_y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span><span class="p">,</span>
                        <span class="s2">&quot;turtle_heading&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span><span class="p">,</span>
                        <span class="s2">&quot;pen_down&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen_down</span><span class="p">,</span>
                        <span class="s2">&quot;pen_color&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span><span class="p">,</span>
                        <span class="s2">&quot;pen_width&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pen_width</span><span class="p">,</span>
                        <span class="s2">&quot;data_list&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="s2">&quot;data_pointer&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_pointer</span><span class="p">,</span>
                        <span class="s2">&quot;common_vars&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;common_vars&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="s2">&quot;objects&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;objects&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="s2">&quot;user_functions&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;user_functions&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="s2">&quot;event_handlers&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;event_handlers&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="s2">&quot;open_files&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;open_files&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="s2">&quot;binary_data&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;binary_data&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                        <span class="s2">&quot;sprites&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sprites</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                    <span class="p">}</span>

                    <span class="c1"># Reset interpreter state</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

                    <span class="c1"># Clear graphics if available</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                        <span class="s2">&quot;Program cleared. Use OLD to restore previous program.&quot;</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NEW command error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;OLD&quot;</span><span class="p">:</span>
                <span class="c1"># OLD - Restore previously saved program state</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;saved_state&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># Restore saved state</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_state</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;variables&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">procedures</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;procedures&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;program_lines&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_line&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stack&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">for_stack</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;for_stack&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">match_flag</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;match_flag&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_last_match_set</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_last_match_set&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;running&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

                        <span class="c1"># Restore turtle state</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;turtle_x&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;turtle_y&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;turtle_heading&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pen_down</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pen_down&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pen_color&quot;</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pen_width</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pen_width&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                        <span class="c1"># Restore other state</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_list&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data_pointer</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_pointer&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">common_vars</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;common_vars&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;objects&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">user_functions</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_functions&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">event_handlers</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;event_handlers&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">open_files</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;open_files&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">binary_data</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;binary_data&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sprites</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sprites&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                        <span class="c1"># Clear saved state after restoration</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">saved_state</span> <span class="o">=</span> <span class="kc">None</span>

                        <span class="c1"># Redraw graphics if available</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
                            <span class="c1"># Note: We don&#39;t restore graphics automatically as that would be complex</span>
                            <span class="c1"># The program would need to redraw itself</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;Previous program restored.&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                            <span class="s2">&quot;No previous program to restore. Use NEW first.&quot;</span>
                        <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OLD command error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;READ&quot;</span><span class="p">:</span>
                <span class="c1"># READ var1, var2, ... - Read values from DATA into variables</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;READ&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="n">var_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
                        <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">var_names</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_pointer</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">):</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_pointer</span><span class="p">]</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">data_pointer</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;Out of data in READ for variable </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span>
                                <span class="p">)</span>
                                <span class="k">break</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;READ statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;RESTORE&quot;</span><span class="p">:</span>
                <span class="c1"># RESTORE [line] - Reset data pointer, optionally to specific line</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Remove &#39;RESTORE&#39;</span>
                    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                        <span class="c1"># Try to parse as line number</span>
                        <span class="n">line_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
                        <span class="c1"># Find the line number in the program and set data pointer accordingly</span>
                        <span class="c1"># For now, just reset to beginning (simplified implementation)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data_pointer</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;RESTORE to line </span><span class="si">{</span><span class="n">line_num</span><span class="si">}</span><span class="s2"> (simplified - reset to beginning)&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Reset data pointer to beginning</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data_pointer</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;Data pointer reset to beginning&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RESTORE statement error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BASIC command error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

        <span class="k">return</span> <span class="s2">&quot;continue&quot;</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.execute_logo_command">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.execute_logo_command">[docs]</a>
    <span class="k">def</span> <span class="nf">execute_logo_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute Logo-like commands&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">command</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

            <span class="n">cmd</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG: Executing Logo command: </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Debug print</span>

            <span class="k">if</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span> <span class="s2">&quot;FD&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">move_turtle</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;BACK&quot;</span><span class="p">,</span> <span class="s2">&quot;BK&quot;</span><span class="p">,</span> <span class="s2">&quot;BACKWARD&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">move_turtle</span><span class="p">(</span><span class="o">-</span><span class="n">distance</span><span class="p">)</span>  <span class="c1"># Move backward</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;LEFT&quot;</span><span class="p">,</span> <span class="s2">&quot;LT&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">degrees</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">+=</span> <span class="n">degrees</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RIGHT&quot;</span><span class="p">,</span> <span class="s2">&quot;RT&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">degrees</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">-=</span> <span class="n">degrees</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PENUP&quot;</span><span class="p">,</span> <span class="s2">&quot;PU&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pen_down</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PENDOWN&quot;</span><span class="p">,</span> <span class="s2">&quot;PD&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pen_down</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CLEARSCREEN&quot;</span><span class="p">,</span> <span class="s2">&quot;CS&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">graphics_widget</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reset_turtle</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;HOME&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span> <span class="o">=</span> <span class="mi">200</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span> <span class="o">=</span> <span class="mi">200</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">=</span> <span class="mi">90</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pen_down</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pen_width</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SETHEADING&quot;</span><span class="p">,</span> <span class="s2">&quot;SETH&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">degrees</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">turtle_heading</span> <span class="o">=</span> <span class="n">degrees</span>

            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;SETX&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span> <span class="o">=</span> <span class="n">x</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;SETY&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span> <span class="o">=</span> <span class="n">y</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;SETXY&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">turtle_x</span> <span class="o">=</span> <span class="n">x</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">turtle_y</span> <span class="o">=</span> <span class="n">y</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PENCOLOR&quot;</span><span class="p">,</span> <span class="s2">&quot;PC&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">color_arg</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">color_arg</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">color_arg</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span> <span class="o">=</span> <span class="n">color_arg</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;PENSIZE&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pen_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;HIDETURTLE&quot;</span><span class="p">,</span> <span class="s2">&quot;HT&quot;</span><span class="p">]:</span>
                <span class="c1"># Turtle visibility - for now just log since we don&#39;t draw turtle cursor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;Turtle hidden&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SHOWTURTLE&quot;</span><span class="p">,</span> <span class="s2">&quot;ST&quot;</span><span class="p">]:</span>
                <span class="c1"># Turtle visibility - for now just log since we don&#39;t draw turtle cursor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;Turtle shown&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SETCOLOR&quot;</span><span class="p">,</span> <span class="s2">&quot;SC&quot;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;DEBUG: SETCOLOR command detected with parts: </span><span class="si">{</span><span class="n">parts</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>  <span class="c1"># Debug print</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">color_arg</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DEBUG: color_arg = </span><span class="si">{</span><span class="n">color_arg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Debug print</span>
                    <span class="k">if</span> <span class="n">color_arg</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">color_arg</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;DEBUG: index = </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">, color = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>  <span class="c1"># Debug print</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;DEBUG: pen_color set to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>  <span class="c1"># Debug print</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pen_color</span> <span class="o">=</span> <span class="n">color_arg</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CLEARTEXT&quot;</span><span class="p">,</span> <span class="s2">&quot;CT&quot;</span><span class="p">]:</span>
                <span class="c1"># Clear text output</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_widget</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">output_widget</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;CIRCLE&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">extent</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">360</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">extent</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;RECT&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_rectangle</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;DOT&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_dot</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;IMAGE&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
                    <span class="n">width</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="p">)</span>
                    <span class="n">height</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_image</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;HUD&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">toggle_hud</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;SNAPSHOT&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">take_snapshot</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;SPRITENEW&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">create_sprite</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;SPRITEPOS&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_sprite_position</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;REPEAT&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="c1"># Parse the bracketed commands</span>
                    <span class="n">command_str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
                    <span class="k">if</span> <span class="n">command_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">command_str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">):</span>
                        <span class="c1"># Remove brackets and parse commands</span>
                        <span class="n">inner_commands</span> <span class="o">=</span> <span class="n">command_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">)):</span>
                            <span class="c1"># Split by spaces but preserve quoted strings and brackets</span>
                            <span class="n">sub_commands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_bracketed_commands</span><span class="p">(</span><span class="n">inner_commands</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">sub_cmd</span> <span class="ow">in</span> <span class="n">sub_commands</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">sub_cmd</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">execute_logo_command</span><span class="p">(</span><span class="n">sub_cmd</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;TO&quot;</span><span class="p">:</span>
                <span class="c1"># Define a procedure: TO procname :param1 :param2 ... commands END</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">proc_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="c1"># Extract parameters from TO line (everything after proc name starting with :)</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                        <span class="k">if</span> <span class="n">part</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">):</span>
                            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>  <span class="c1"># Remove : and uppercase</span>

                    <span class="c1"># Find the END</span>
                    <span class="n">end_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">i</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span>
                            <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;END&quot;</span>
                        <span class="p">):</span>
                            <span class="n">end_idx</span> <span class="o">=</span> <span class="n">i</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">end_idx</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span><span class="p">:</span>
                        <span class="c1"># Extract procedure body (skip the TO line itself)</span>
                        <span class="n">body_lines</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">body_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                        <span class="c1"># Store procedure with parameters</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;logo_procedures&quot;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logo_procedures</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logo_procedures</span><span class="p">[</span><span class="n">proc_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
                            <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">body_lines</span><span class="p">,</span>
                        <span class="p">}</span>
                        <span class="c1"># Skip to END</span>
                        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;jump:</span><span class="si">{</span><span class="n">end_idx</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logo_procedures</span><span class="p">:</span>
                <span class="c1"># Call a defined procedure</span>
                <span class="n">proc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logo_procedures</span><span class="p">[</span><span class="n">cmd</span><span class="p">]</span>
                <span class="c1"># Handle parameters if any</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[]</span>
                <span class="n">param_vars</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="c1"># Check parameter count</span>
                <span class="n">expected_params</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">proc</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">!=</span> <span class="n">expected_params</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Procedure </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2"> expects </span><span class="si">{</span><span class="n">expected_params</span><span class="si">}</span><span class="s2"> parameters, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

                <span class="c1"># Assign parameters to variables</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">proc</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
                        <span class="n">param_vars</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="c1"># Execute procedure body with parameter variables</span>
                <span class="n">old_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_vars</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">body_line</span> <span class="ow">in</span> <span class="n">proc</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">body_line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                            <span class="c1"># Substitute Logo :param syntax with actual values</span>
                            <span class="n">substituted_line</span> <span class="o">=</span> <span class="n">body_line</span>
                            <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_value</span> <span class="ow">in</span> <span class="n">param_vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="n">substituted_line</span> <span class="o">=</span> <span class="n">substituted_line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">param_value</span><span class="p">)</span>
                                <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">execute_line</span><span class="p">(</span><span class="n">substituted_line</span><span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="n">old_vars</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;❌ Error in Logo command &#39;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display_error</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;continue&quot;</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.determine_command_type">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.determine_command_type">[docs]</a>
    <span class="k">def</span> <span class="nf">determine_command_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine which language the command belongs to&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">command</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;pilot&quot;</span>

        <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1"># PILOT commands start with a letter followed by colon</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">command</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;:&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;pilot&quot;</span>

        <span class="c1"># Logo commands</span>
        <span class="n">logo_commands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BACK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BACKWARD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LEFT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RIGHT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PENUP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PU&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PENDOWN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CLEARSCREEN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HOME&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SETXY&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SETX&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SETY&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SETHEADING&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SETH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SETCOLOR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PENCOLOR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PENSIZE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HIDETURTLE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SHOWTURTLE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ST&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CLEARTEXT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;REPEAT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TO&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">logo_commands</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;logo&quot;</span>

        <span class="c1"># Check if it&#39;s a Logo procedure call</span>
        <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logo_procedures</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;logo&quot;</span>

        <span class="c1"># BASIC commands</span>
        <span class="n">basic_commands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;LET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PRINT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;INPUT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GOTO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;IF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;THEN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FOR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NEXT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GOSUB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RETURN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;END&quot;</span><span class="p">,</span>
            <span class="s2">&quot;REM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SCREEN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;COLOR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PALETTE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PSET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PRESET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CIRCLE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DRAW&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PAINT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PLAY&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SOUND&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BEEP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OBJECT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DEF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ACTIVATE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OPEN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CLOSE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PUT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BLOAD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BSAVE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CHAIN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;COMMON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ERASE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RANDOMIZE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SWAP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CALL&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PEEK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;POKE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;WAIT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;INKEY$&quot;</span><span class="p">,</span>
            <span class="s2">&quot;STICK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;STRIG&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DATA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;READ&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RESTORE&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">basic_commands</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;basic&quot;</span>

        <span class="c1"># Default to PILOT for simple commands</span>
        <span class="k">return</span> <span class="s2">&quot;pilot&quot;</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.execute_line">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.execute_line">[docs]</a>
    <span class="k">def</span> <span class="nf">execute_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a single line of code&quot;&quot;&quot;</span>
        <span class="n">line_num</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">command</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

        <span class="n">parts</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parts</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">procedures</span><span class="p">:</span>
            <span class="n">proc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">procedures</span><span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">proc</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Procedure </span><span class="si">{</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> expects </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">proc</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> args, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>
            <span class="n">old_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">proc</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">],</span> <span class="n">args</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">body_line</span> <span class="ow">in</span> <span class="n">proc</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_line</span><span class="p">(</span><span class="n">body_line</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="n">old_vars</span>
            <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

        <span class="k">if</span> <span class="n">parts</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;END&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;continue&quot;</span>

        <span class="c1"># Determine command type and execute</span>
        <span class="n">cmd_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_command_type</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;pilot&quot;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_pilot_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;basic&quot;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_basic_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cmd_type</span> <span class="o">==</span> <span class="s2">&quot;logo&quot;</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_logo_command</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;continue&quot;</span>

        <span class="c1"># Ensure we always return a string</span>
        <span class="k">return</span> <span class="n">result</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;continue&quot;</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.load_program">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.load_program">[docs]</a>
    <span class="k">def</span> <span class="nf">load_program</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load and parse a program&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">program_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Parse lines and collect labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">line_num</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">line_num</span><span class="p">,</span> <span class="n">command</span><span class="p">))</span>

            <span class="c1"># Collect PILOT labels</span>
            <span class="k">if</span> <span class="n">command</span> <span class="ow">and</span> <span class="n">command</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;L:&quot;</span><span class="p">):</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">command</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

        <span class="c1"># Parse procedures (skip Logo TO commands as they are handled</span>
        <span class="c1"># during execution)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">procedures</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># Skip Logo TO commands - they are handled during execution,</span>
            <span class="c1"># not loading</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">command</span>
                <span class="ow">and</span> <span class="n">command</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TO &quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">determine_command_type</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;logo&quot;</span>
            <span class="p">):</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Skip the procedure body until END</span>
                <span class="k">while</span> <span class="p">(</span>
                    <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;END&quot;</span>
                <span class="p">):</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">):</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Skip the END</span>
            <span class="k">elif</span> <span class="n">command</span> <span class="ow">and</span> <span class="n">command</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;TO &quot;</span><span class="p">):</span>
                <span class="c1"># Parse as other language procedures (if any)</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">[]</span>
                <span class="n">body</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="p">(</span>
                    <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;END&quot;</span>
                <span class="p">):</span>
                    <span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">procedures</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">body</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.execute_program">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.execute_program">[docs]</a>
    <span class="k">def</span> <span class="nf">execute_program</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a program - wrapper for run_program&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_program</span><span class="p">(</span><span class="n">program_text</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.run_program">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.run_program">[docs]</a>
    <span class="k">def</span> <span class="nf">run_program</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run a complete program&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_program</span><span class="p">(</span><span class="n">program_text</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;Error loading program&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iterations</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">)</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span>
                <span class="ow">and</span> <span class="n">iterations</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_iterations</span>
            <span class="p">):</span>
                <span class="n">iterations</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">breakpoints</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Breakpoint hit at line </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># In a real debugger, this would pause execution</span>

                <span class="n">line_num</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_line</span><span class="p">]</span>

                <span class="c1"># Skip empty lines</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">continue</span>

                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_line</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;jump:&quot;</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">jump_target</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="n">jump_target</span>
                        <span class="k">continue</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error parsing jump target: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;Program terminated due to error&quot;</span><span class="p">)</span>
                    <span class="k">break</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">iterations</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_iterations</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;Program stopped: Maximum iterations reached&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Runtime error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;Program execution completed&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.step">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.step">[docs]</a>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a single line and pause (for debugger stepping).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">line_num</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_line</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_line</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">result</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;jump:&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">jump_target</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="n">jump_target</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">+=</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.continue_running">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.continue_running">[docs]</a>
    <span class="k">def</span> <span class="nf">continue_running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Continue running until breakpoint or end.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">max_iterations</span> <span class="o">=</span> <span class="mi">10000</span>
        <span class="n">iterations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_lines</span><span class="p">)</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span>
                <span class="ow">and</span> <span class="n">iterations</span> <span class="o">&lt;</span> <span class="n">max_iterations</span>
            <span class="p">):</span>
                <span class="n">iterations</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">breakpoints</span><span class="p">:</span>
                    <span class="c1"># Pause at breakpoint</span>
                    <span class="k">break</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">iterations</span> <span class="o">&gt;=</span> <span class="n">max_iterations</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="s2">&quot;Program stopped: Maximum iterations reached&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Runtime error during continue: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.stop_program">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.stop_program">[docs]</a>
    <span class="k">def</span> <span class="nf">stop_program</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop program execution&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.set_debug_mode">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.set_debug_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">set_debug_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable/disable debug mode&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span> <span class="o">=</span> <span class="n">enabled</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.toggle_breakpoint">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.toggle_breakpoint">[docs]</a>
    <span class="k">def</span> <span class="nf">toggle_breakpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_number</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Toggle breakpoint at line&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">line_number</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">breakpoints</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">breakpoints</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">line_number</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">breakpoints</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line_number</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpInterpreter.parse_bracketed_commands">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpInterpreter.parse_bracketed_commands">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_bracketed_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">commands_str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse Logo commands from bracketed string, handling nested brackets&quot;&quot;&quot;</span>
        <span class="n">cmd_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">):</span>
            <span class="c1"># Skip whitespace</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">):</span>
                <span class="k">break</span>

            <span class="c1"># Check for known commands that take parameters</span>
            <span class="k">if</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;FD&quot;</span><span class="p">,</span> <span class="s2">&quot;BK&quot;</span><span class="p">,</span> <span class="s2">&quot;LT&quot;</span><span class="p">,</span> <span class="s2">&quot;RT&quot;</span><span class="p">]:</span>
                <span class="c1"># These commands take one parameter</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="c1"># Skip whitespace</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Find the parameter (until next space or end)</span>
                <span class="n">param_start</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">param</span> <span class="o">=</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">param_start</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
                <span class="n">cmd_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FORWARD&quot;</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;FORWARD&quot;</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">6</span>
                <span class="c1"># Skip whitespace</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Find the parameter</span>
                <span class="n">param_start</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">param</span> <span class="o">=</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">param_start</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
                <span class="n">cmd_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;BACK&quot;</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;BACK&quot;</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">4</span>
                <span class="c1"># Skip whitespace</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Find the parameter</span>
                <span class="n">param_start</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">param</span> <span class="o">=</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">param_start</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
                <span class="n">cmd_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;LEFT&quot;</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;LEFT&quot;</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">4</span>
                <span class="c1"># Skip whitespace</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Find the parameter</span>
                <span class="n">param_start</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">param</span> <span class="o">=</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">param_start</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
                <span class="n">cmd_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;RIGHT&quot;</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;RIGHT&quot;</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">5</span>
                <span class="c1"># Skip whitespace</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Find the parameter</span>
                <span class="n">param_start</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">param</span> <span class="o">=</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">param_start</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
                <span class="n">cmd_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;SETCOLOR&quot;</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;SETCOLOR&quot;</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">8</span>
                <span class="c1"># Skip whitespace</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Find the parameter</span>
                <span class="n">param_start</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">param</span> <span class="o">=</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">param_start</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
                <span class="n">cmd_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;REPEAT&quot;</span><span class="p">:</span>
                <span class="c1"># Handle nested REPEAT</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;REPEAT&quot;</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">6</span>
                <span class="c1"># Skip whitespace</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Find the count parameter</span>
                <span class="n">count_start</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">count_start</span><span class="p">:</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># Skip whitespace to [</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;[&quot;</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># skip [</span>
                    <span class="c1"># Find matching closing ]</span>
                    <span class="n">bracket_count</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">nested_start</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands_str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">bracket_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;[&quot;</span><span class="p">:</span>
                            <span class="n">bracket_count</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">elif</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;]&quot;</span><span class="p">:</span>
                            <span class="n">bracket_count</span> <span class="o">-=</span> <span class="mi">1</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">nested_commands</span> <span class="o">=</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">nested_start</span> <span class="p">:</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># exclude ]</span>
                    <span class="n">cmd_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> [ </span><span class="si">{</span><span class="n">nested_commands</span><span class="si">}</span><span class="s2"> ]&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Malformed, skip</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Single command without parameters</span>
                <span class="n">single_cmds</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;PENUP&quot;</span><span class="p">,</span> <span class="s2">&quot;PENDOWN&quot;</span><span class="p">,</span> <span class="s2">&quot;CLEARSCREEN&quot;</span><span class="p">,</span> <span class="s2">&quot;HOME&quot;</span><span class="p">]</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="n">single_cmds</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">commands_str</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">sc</span><span class="p">)]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">sc</span><span class="p">:</span>
                        <span class="n">cmd_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
                        <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                    <span class="c1"># Unknown, skip character</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">cmd_list</span></div>
</div>



<div class="viewcode-block" id="IntelligentCodeCompletion">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.IntelligentCodeCompletion">[docs]</a>
<span class="k">class</span> <span class="nc">IntelligentCodeCompletion</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Advanced code completion system for Time Warp IDE&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_widget</span><span class="p">,</span> <span class="n">ide</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span> <span class="o">=</span> <span class="n">text_widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ide</span> <span class="o">=</span> <span class="n">ide</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completion_window</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completion_start</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Command definitions with context and descriptions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pilot_commands</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;T:&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Text output - Display text to the user&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;text_output&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;T:Hello World!&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;A:&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Accept input - Get input from user into variable&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;user_input&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;A:NAME&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;Y:&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Yes condition - Set match flag if condition is true&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;conditional&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;Y:AGE &gt; 18&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;N:&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;No condition - Set match flag if condition is false&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;conditional&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;N:AGE &lt; 18&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;J:&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Jump - Go to label or conditional jump&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;flow_control&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;J:LABEL or J(condition):LABEL&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;M:&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Match - Pattern matching for text input&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;pattern_match&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;M:YES,OK,SURE&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;R:&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Runtime/Resource command - Advanced features&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;advanced&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;R:ARDUINO CONNECT&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;ML:&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Machine Learning command - AI/ML operations&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;ML:LOAD mymodel linear_regression&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;GAME:&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Game Development command - Create and control game objects&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;game&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME:CREATE player sprite 100 100&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;C:&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Compute/Call - Calculate expression or call subroutine&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;computation&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;C:RESULT = X + Y&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;L:&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Label - Define a program location&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;L:START&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;U:&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Use/Update - Set variable value&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;variable&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;U:COUNT=10&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;END&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;End program execution&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;flow_control&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;END&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;E:&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;End program execution (short form)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;flow_control&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;E:&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

        <span class="c1"># ML subcommands for PILOT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pilot_ml_commands</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ML:LOAD&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Load ML model&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml_load&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;ML:LOAD mymodel linear_regression&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;ML:DATA&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Create sample dataset&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml_data&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;ML:DATA mydata linear&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;ML:TRAIN&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Train ML model&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml_train&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;ML:TRAIN mymodel mydata&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;ML:PREDICT&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Make prediction&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml_predict&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;ML:PREDICT mymodel 5.0,3.2 RESULT&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;ML:EVALUATE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Evaluate model performance&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml_eval&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;ML:EVALUATE mymodel testdata SCORE&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;ML:LIST&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;List models or data&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml_list&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;ML:LIST MODELS&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;ML:CLEAR&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Clear all ML data&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml_clear&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;ML:CLEAR&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;ML:INFO&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Get model information&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml_info&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;ML:INFO mymodel&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;ML:DEMO&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Run ML demonstration&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml_demo&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;ML:DEMO linear&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

        <span class="c1"># Game Development commands for PILOT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pilot_game_commands</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;GAME:CREATE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Create game object&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;game_create&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME:CREATE player sprite 100 100 32 32&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;GAME:MOVE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Move game object&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;game_move&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME:MOVE player 10 0 5&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;GAME:PHYSICS&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Set physics properties&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;game_physics&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME:PHYSICS GRAVITY 9.8&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;GAME:COLLISION&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Check collision between objects&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;game_collision&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME:COLLISION CHECK player enemy HIT&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;GAME:RENDER&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Render game scene&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;game_render&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME:RENDER&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;GAME:UPDATE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Update game physics&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;game_update&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME:UPDATE 0.016&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;GAME:DELETE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Delete game object&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;game_delete&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME:DELETE enemy1&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;GAME:LIST&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;List all game objects&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;game_list&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME:LIST&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;GAME:CLEAR&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Clear all game objects&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;game_clear&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME:CLEAR&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;GAME:INFO&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Get object information&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;game_info&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME:INFO player&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;GAME:DEMO&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Run game demonstration&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;game_demo&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;GAME:DEMO pong&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logo_commands</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;FORWARD&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Move turtle forward by specified distance&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;movement&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;FORWARD 100&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;FD&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Move turtle forward (short form)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;movement&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;FD 50&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;BACK&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Move turtle backward by specified distance&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;movement&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;BACK 50&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;BK&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Move turtle backward (short form)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;movement&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;BK 30&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;LEFT&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Turn turtle left by degrees&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;rotation&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;LEFT 90&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;LT&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Turn turtle left (short form)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;rotation&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;LT 45&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;RIGHT&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Turn turtle right by degrees&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;rotation&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;RIGHT 90&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;RT&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Turn turtle right (short form)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;rotation&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;RT 45&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;PENUP&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Lift pen (stop drawing)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;pen_control&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;PENUP&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;PU&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Lift pen (short form)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;pen_control&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;PU&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;PENDOWN&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Lower pen (start drawing)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;pen_control&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;PENDOWN&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;PD&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Lower pen (short form)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;pen_control&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;PD&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;CLEARSCREEN&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Clear the graphics canvas&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;canvas&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;CLEARSCREEN&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;CS&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Clear screen (short form)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;canvas&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;CS&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;HOME&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Move turtle to center (0,0)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;positioning&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;HOME&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;SETXY&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Set turtle position to coordinates&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;positioning&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;SETXY 100 50&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;SETHEADING&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Set turtle heading in degrees&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;rotation&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;SETHEADING 0&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;SETH&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Set heading (short form)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;rotation&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;SETH 90&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;REPEAT&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Repeat commands specified number of times&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;loop&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;REPEAT 4 [FD 100 RT 90]&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;DEFINE&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Define a custom procedure&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;procedure&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;DEFINE SQUARE [REPEAT 4 [FD 100 RT 90]]&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;CALL&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Call a defined procedure&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;procedure&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;CALL SQUARE&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="c1"># ML Commands</span>
            <span class="s2">&quot;LOADMODEL&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Load machine learning model&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;LOADMODEL mymodel linear_regression&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;CREATEDATA&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Create sample ML dataset&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;CREATEDATA mydata linear&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;TRAINMODEL&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Train ML model with dataset&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;TRAINMODEL mymodel mydata&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;PREDICT&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Make ML prediction&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;PREDICT mymodel 5.0,3.2&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;EVALUATEMODEL&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Evaluate ML model performance&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;EVALUATEMODEL mymodel testdata&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;MLDEMO&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Run ML demonstration&quot;</span><span class="p">,</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="s2">&quot;ml&quot;</span><span class="p">,</span>
                <span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="s2">&quot;MLDEMO linear&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

        <span class="c1"># Bind events for code completion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;KeyRelease&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_key_release</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_completion</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Control-space&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_completion</span><span class="p">)</span>

<div class="viewcode-block" id="IntelligentCodeCompletion.on_key_release">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.IntelligentCodeCompletion.on_key_release">[docs]</a>
    <span class="k">def</span> <span class="nf">on_key_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle key release events for triggering completion&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">keysym</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Up&quot;</span><span class="p">,</span> <span class="s2">&quot;Down&quot;</span><span class="p">,</span> <span class="s2">&quot;Left&quot;</span><span class="p">,</span> <span class="s2">&quot;Right&quot;</span><span class="p">,</span> <span class="s2">&quot;Return&quot;</span><span class="p">,</span> <span class="s2">&quot;Tab&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hide_completion</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1"># Get current cursor position and word</span>
        <span class="n">cursor_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">INSERT</span><span class="p">)</span>
        <span class="n">line_start</span> <span class="o">=</span> <span class="n">cursor_pos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.0&quot;</span>
        <span class="n">line_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line_start</span><span class="p">,</span> <span class="n">cursor_pos</span><span class="p">)</span>

        <span class="c1"># Find the current word being typed</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">line_text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">words</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line_text</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_word</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_word</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Start completion after 2 chars</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_completion_suggestions</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hide_completion</span><span class="p">()</span></div>


<div class="viewcode-block" id="IntelligentCodeCompletion.show_completion">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.IntelligentCodeCompletion.show_completion">[docs]</a>
    <span class="k">def</span> <span class="nf">show_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Manually trigger completion with Ctrl+Space&quot;&quot;&quot;</span>
        <span class="n">cursor_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">INSERT</span><span class="p">)</span>
        <span class="n">line_start</span> <span class="o">=</span> <span class="n">cursor_pos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.0&quot;</span>
        <span class="n">line_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">line_start</span><span class="p">,</span> <span class="n">cursor_pos</span><span class="p">)</span>

        <span class="n">words</span> <span class="o">=</span> <span class="n">line_text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">words</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line_text</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_word</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_completion_suggestions</span><span class="p">()</span></div>


<div class="viewcode-block" id="IntelligentCodeCompletion.show_completion_suggestions">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.IntelligentCodeCompletion.show_completion_suggestions">[docs]</a>
    <span class="k">def</span> <span class="nf">show_completion_suggestions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show completion suggestions based on current context&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_word</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Get matching commands</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_commands</span> <span class="o">=</span> <span class="p">{</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pilot_commands</span><span class="p">,</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">logo_commands</span><span class="p">,</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_commands</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Check for ML subcommands</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_word</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ML:&quot;</span><span class="p">):</span>
            <span class="n">all_commands</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pilot_ml_commands</span><span class="p">)</span>

        <span class="c1"># Check for Game subcommands</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_word</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;GAME:&quot;</span><span class="p">):</span>
            <span class="n">all_commands</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pilot_game_commands</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">all_commands</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_word</span> <span class="ow">and</span> <span class="n">cmd</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_word</span><span class="p">):</span>
                <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cmd</span><span class="p">,</span> <span class="n">info</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">suggestions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hide_completion</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1"># Show completion window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_completion_window</span><span class="p">(</span><span class="n">suggestions</span><span class="p">)</span></div>


<div class="viewcode-block" id="IntelligentCodeCompletion.show_completion_window">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.IntelligentCodeCompletion.show_completion_window">[docs]</a>
    <span class="k">def</span> <span class="nf">show_completion_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">suggestions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the completion popup window&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hide_completion</span><span class="p">()</span>  <span class="c1"># Hide any existing window</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">suggestions</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Create completion window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completion_window</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completion_window</span><span class="o">.</span><span class="n">wm_overrideredirect</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completion_window</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="n">borderwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Position window near cursor</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">INSERT</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">winfo_rootx</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">winfo_rooty</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completion_window</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;+</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Create listbox for suggestions</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">completion_window</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">listbox</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Listbox</span><span class="p">(</span>
            <span class="n">frame</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">suggestions</span><span class="p">)),</span>
            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Consolas&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
            <span class="n">selectbackground</span><span class="o">=</span><span class="s2">&quot;#0078d4&quot;</span><span class="p">,</span>
            <span class="n">selectforeground</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
            <span class="n">borderwidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">highlightthickness</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">listbox</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Add scrollbar if needed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">suggestions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">scrollbar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="n">listbox</span><span class="o">.</span><span class="n">yview</span><span class="p">)</span>
            <span class="n">scrollbar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span>
            <span class="n">listbox</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">yscrollcommand</span><span class="o">=</span><span class="n">scrollbar</span><span class="o">.</span><span class="n">set</span><span class="p">)</span>

        <span class="c1"># Populate suggestions</span>
        <span class="k">for</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">suggestions</span><span class="p">:</span>
            <span class="n">display_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cmd</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">listbox</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">,</span> <span class="n">display_text</span><span class="p">)</span>

        <span class="c1"># Select first item</span>
        <span class="k">if</span> <span class="n">suggestions</span><span class="p">:</span>
            <span class="n">listbox</span><span class="o">.</span><span class="n">selection_set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Bind events</span>
        <span class="n">listbox</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="s2">&quot;&lt;Double-Button-1&gt;&quot;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">insert_completion</span><span class="p">(</span><span class="n">suggestions</span><span class="p">[</span><span class="n">listbox</span><span class="o">.</span><span class="n">curselection</span><span class="p">()[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="n">listbox</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="s2">&quot;&lt;Return&gt;&quot;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">insert_completion</span><span class="p">(</span><span class="n">suggestions</span><span class="p">[</span><span class="n">listbox</span><span class="o">.</span><span class="n">curselection</span><span class="p">()[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="n">listbox</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Escape&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_completion</span><span class="p">())</span>

        <span class="c1"># Focus the listbox</span>
        <span class="n">listbox</span><span class="o">.</span><span class="n">focus_set</span><span class="p">()</span></div>


<div class="viewcode-block" id="IntelligentCodeCompletion.insert_completion">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.IntelligentCodeCompletion.insert_completion">[docs]</a>
    <span class="k">def</span> <span class="nf">insert_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert selected completion into editor&quot;&quot;&quot;</span>
        <span class="c1"># Find the start position of current word</span>
        <span class="n">cursor_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">INSERT</span><span class="p">)</span>
        <span class="n">line_num</span><span class="p">,</span> <span class="n">col_num</span> <span class="o">=</span> <span class="n">cursor_pos</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">col_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">col_num</span><span class="p">)</span>

        <span class="c1"># Find start of current word</span>
        <span class="n">line_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line_num</span><span class="si">}</span><span class="s2">.0&quot;</span><span class="p">,</span> <span class="n">cursor_pos</span><span class="p">)</span>
        <span class="n">word_start</span> <span class="o">=</span> <span class="n">col_num</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">col_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">line_text</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="n">line_text</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">or</span> <span class="n">line_text</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">word_start</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Replace current word with completion</span>
        <span class="n">start_pos</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line_num</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">word_start</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">start_pos</span><span class="p">,</span> <span class="n">cursor_pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">start_pos</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>

        <span class="c1"># Add space after command if appropriate</span>
        <span class="k">if</span> <span class="n">command</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">INSERT</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">logo_commands</span> <span class="ow">or</span> <span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_commands</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">INSERT</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hide_completion</span><span class="p">()</span></div>


<div class="viewcode-block" id="IntelligentCodeCompletion.hide_completion">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.IntelligentCodeCompletion.hide_completion">[docs]</a>
    <span class="k">def</span> <span class="nf">hide_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Hide the completion window&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">completion_window</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">completion_window</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">completion_window</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="IntelligentCodeCompletion.get_context_help">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.IntelligentCodeCompletion.get_context_help">[docs]</a>
    <span class="k">def</span> <span class="nf">get_context_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get detailed help for a command&quot;&quot;&quot;</span>
        <span class="n">all_commands</span> <span class="o">=</span> <span class="p">{</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pilot_commands</span><span class="p">,</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">logo_commands</span><span class="p">,</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">basic_commands</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">all_commands</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="n">all_commands</span><span class="p">[</span><span class="n">command</span><span class="p">]</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;desc&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">Example: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>
</div>



<div class="viewcode-block" id="RealTimeSyntaxChecker">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.RealTimeSyntaxChecker">[docs]</a>
<span class="k">class</span> <span class="nc">RealTimeSyntaxChecker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Real-time syntax error detection and highlighting&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_widget</span><span class="p">,</span> <span class="n">ide</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span> <span class="o">=</span> <span class="n">text_widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ide</span> <span class="o">=</span> <span class="n">ide</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_tag</span> <span class="o">=</span> <span class="s2">&quot;syntax_error&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warning_tag</span> <span class="o">=</span> <span class="s2">&quot;syntax_warning&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_error_tags</span><span class="p">()</span>

<div class="viewcode-block" id="RealTimeSyntaxChecker.setup_error_tags">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.RealTimeSyntaxChecker.setup_error_tags">[docs]</a>
    <span class="k">def</span> <span class="nf">setup_error_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup text tags for error highlighting&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">tag_configure</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_tag</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s2">&quot;#FFE6E6&quot;</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s2">&quot;#CC0000&quot;</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">tag_configure</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning_tag</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s2">&quot;#FFF4E6&quot;</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s2">&quot;#CC6600&quot;</span><span class="p">,</span> <span class="n">underline</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="RealTimeSyntaxChecker.on_key_release">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.RealTimeSyntaxChecker.on_key_release">[docs]</a>
    <span class="k">def</span> <span class="nf">on_key_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle key release events for syntax checking&quot;&quot;&quot;</span>
        <span class="c1"># Debounce syntax checking - only check after a short delay</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_check_timer&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">after_cancel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_timer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_timer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">after</span><span class="p">(</span>
            <span class="mi">300</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_syntax</span>
        <span class="p">)</span>  <span class="c1"># Check after 300ms delay</span></div>


<div class="viewcode-block" id="RealTimeSyntaxChecker.check_syntax">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.RealTimeSyntaxChecker.check_syntax">[docs]</a>
    <span class="k">def</span> <span class="nf">check_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check syntax of current content and highlight errors&quot;&quot;&quot;</span>
        <span class="c1"># Clear existing error highlights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_tag</span><span class="p">,</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warning_tag</span><span class="p">,</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>

        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Check PILOT syntax</span>
            <span class="n">pilot_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_pilot_syntax</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">line_num</span><span class="p">)</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pilot_errors</span><span class="p">)</span>

            <span class="c1"># Check Logo syntax</span>
            <span class="n">logo_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_logo_syntax</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">line_num</span><span class="p">)</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">logo_errors</span><span class="p">)</span>

            <span class="c1"># Check BASIC syntax</span>
            <span class="n">basic_errors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_basic_syntax</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">line_num</span><span class="p">)</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">basic_errors</span><span class="p">)</span>

            <span class="c1"># Check for common issues</span>
            <span class="n">common_warnings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_common_issues</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">line_num</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">common_warnings</span><span class="p">)</span>

        <span class="c1"># Highlight errors and warnings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlight_issues</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>

        <span class="c1"># Update status bar with error count</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ide</span><span class="p">,</span> <span class="s2">&quot;status_label&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;❌ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> syntax errors found&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">warnings</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;⚠️ </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">warnings</span><span class="p">)</span><span class="si">}</span><span class="s2"> warnings&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ide</span><span class="o">.</span><span class="n">status_label</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;✅ No syntax errors&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="RealTimeSyntaxChecker.check_pilot_syntax">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.RealTimeSyntaxChecker.check_pilot_syntax">[docs]</a>
    <span class="k">def</span> <span class="nf">check_pilot_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">line_num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check PILOT command syntax&quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;:&quot;</span><span class="p">:</span>  <span class="c1"># PILOT command</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">payload</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="n">valid_pilot_cmds</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s2">&quot;T:&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;A:&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Y:&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;N:&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;J:&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;M:&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;R:&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;C:&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;L:&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;U:&quot;</span><span class="p">,</span>
                <span class="p">]</span>

                <span class="k">if</span> <span class="n">cmd</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_pilot_cmds</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unknown PILOT command: </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">)</span>

                <span class="c1"># Command-specific validation</span>
                <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;J:&quot;</span> <span class="ow">and</span> <span class="n">payload</span><span class="p">:</span>
                    <span class="c1"># Check conditional jump syntax J(condition):label</span>
                    <span class="kn">import</span> <span class="nn">re</span>

                    <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">payload</span> <span class="ow">and</span> <span class="s2">&quot;)&quot;</span> <span class="ow">in</span> <span class="n">payload</span> <span class="ow">and</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">payload</span><span class="p">:</span>
                        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\((.+?)\):(.+)$&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
                            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid conditional jump syntax. Use J(condition):label&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                                <span class="p">}</span>
                            <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">payload</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">payload</span><span class="o">.</span><span class="n">isalnum</span><span class="p">():</span>
                        <span class="c1"># Simple jump to label - should be alphanumeric</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[A-Za-z_][A-Za-z0-9_]*$&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
                            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid label name. Use letters, numbers, and underscores only&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                                <span class="p">}</span>
                            <span class="p">)</span>

                <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;L:&quot;</span> <span class="ow">and</span> <span class="n">payload</span><span class="p">:</span>
                    <span class="c1"># Label definition - should be alphanumeric</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[A-Za-z_][A-Za-z0-9_]*$&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
                        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid label name. Use letters, numbers, and underscores only&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                            <span class="p">}</span>
                        <span class="p">)</span>

        <span class="k">return</span> <span class="n">errors</span></div>


<div class="viewcode-block" id="RealTimeSyntaxChecker.check_logo_syntax">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.RealTimeSyntaxChecker.check_logo_syntax">[docs]</a>
    <span class="k">def</span> <span class="nf">check_logo_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">line_num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check Logo command syntax&quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">words</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">errors</span>

        <span class="n">first_word</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">logo_movement_cmds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BACK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LEFT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RIGHT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RT&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">logo_positioning_cmds</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SETXY&quot;</span><span class="p">,</span> <span class="s2">&quot;SETHEADING&quot;</span><span class="p">,</span> <span class="s2">&quot;SETH&quot;</span><span class="p">]</span>
        <span class="n">logo_repeat_cmds</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;REPEAT&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">first_word</span> <span class="ow">in</span> <span class="n">logo_movement_cmds</span><span class="p">:</span>
            <span class="c1"># Movement commands need a numeric parameter</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_word</span><span class="si">}</span><span class="s2"> command requires a numeric parameter&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_numeric_or_variable</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_word</span><span class="si">}</span><span class="s2"> parameter must be a number or variable&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">first_word</span> <span class="ow">in</span> <span class="n">logo_positioning_cmds</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">first_word</span> <span class="o">==</span> <span class="s2">&quot;SETXY&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;SETXY requires two parameters (X and Y coordinates)&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">first_word</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SETHEADING&quot;</span><span class="p">,</span> <span class="s2">&quot;SETH&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_word</span><span class="si">}</span><span class="s2"> requires a numeric parameter (degrees)&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">first_word</span> <span class="o">==</span> <span class="s2">&quot;REPEAT&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;REPEAT requires count and command list [...]&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;[&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s2">&quot;]&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;REPEAT commands must be enclosed in brackets [...]&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">errors</span></div>


<div class="viewcode-block" id="RealTimeSyntaxChecker.check_basic_syntax">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.RealTimeSyntaxChecker.check_basic_syntax">[docs]</a>
    <span class="k">def</span> <span class="nf">check_basic_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">line_num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check BASIC syntax&quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check for line numbers at start</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">words</span> <span class="ow">and</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="c1"># BASIC line with line number</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Line number must be followed by a command&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">command</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="n">basic_cmds</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s2">&quot;LET&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;PRINT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;INPUT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;GOTO&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;IF&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;FOR&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;GOSUB&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;RETURN&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;END&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;REM&quot;</span><span class="p">,</span>
                <span class="p">]</span>

                <span class="k">if</span> <span class="n">command</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">basic_cmds</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unknown BASIC command: </span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">)</span>

                <span class="c1"># Command-specific validation</span>
                <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;LET&quot;</span> <span class="ow">and</span> <span class="s2">&quot;=&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;LET statement requires assignment with =&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&quot;GOTO&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;GOTO requires a line number&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">errors</span></div>


<div class="viewcode-block" id="RealTimeSyntaxChecker.check_common_issues">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.RealTimeSyntaxChecker.check_common_issues">[docs]</a>
    <span class="k">def</span> <span class="nf">check_common_issues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">line_num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for common programming issues&quot;&quot;&quot;</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check for potential variable naming issues</span>
        <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="c1"># Variable interpolation - check for proper format</span>
            <span class="kn">import</span> <span class="nn">re</span>

            <span class="n">vars_in_line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\*([^*]+)\*&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">vars_in_line</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[A-Za-z_][A-Za-z0-9_]*$&quot;</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Variable name &#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">&#39; should use letters, numbers, and underscores only&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">)</span>

        <span class="c1"># Check for missing colons in PILOT commands</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s2">&quot;TAYNMJRCLU&quot;</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;:&quot;</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="n">line_num</span><span class="p">,</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;PILOT commands should end with colon (:)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">warnings</span></div>


<div class="viewcode-block" id="RealTimeSyntaxChecker.is_numeric_or_variable">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.RealTimeSyntaxChecker.is_numeric_or_variable">[docs]</a>
    <span class="k">def</span> <span class="nf">is_numeric_or_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if value is numeric or a valid variable reference&quot;&quot;&quot;</span>
        <span class="c1"># Check if it&#39;s a number</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Check if it&#39;s a variable (contains *)</span>
        <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Check if it&#39;s a valid identifier</span>
        <span class="kn">import</span> <span class="nn">re</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[A-Za-z_][A-Za-z0-9_]*$&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span></div>


<div class="viewcode-block" id="RealTimeSyntaxChecker.highlight_issues">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.RealTimeSyntaxChecker.highlight_issues">[docs]</a>
    <span class="k">def</span> <span class="nf">highlight_issues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Highlight errors and warnings in the text&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">line_start</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.0&quot;</span>
            <span class="n">line_end</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.end&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_tag</span><span class="p">,</span> <span class="n">line_start</span><span class="p">,</span> <span class="n">line_end</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">warning</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">:</span>
            <span class="n">line_start</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">warning</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.0&quot;</span>
            <span class="n">line_end</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">warning</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.end&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">warning_tag</span><span class="p">,</span> <span class="n">line_start</span><span class="p">,</span> <span class="n">line_end</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="CodeFoldingSystem">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.CodeFoldingSystem">[docs]</a>
<span class="k">class</span> <span class="nc">CodeFoldingSystem</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Code folding system for collapsing/expanding code blocks&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_widget</span><span class="p">,</span> <span class="n">line_numbers_widget</span><span class="p">,</span> <span class="n">ide</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span> <span class="o">=</span> <span class="n">text_widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_numbers_widget</span> <span class="o">=</span> <span class="n">line_numbers_widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ide</span> <span class="o">=</span> <span class="n">ide</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folded_blocks</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># {start_line: end_line}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fold_markers</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># {line: marker_widget}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_folding</span><span class="p">()</span>

<div class="viewcode-block" id="CodeFoldingSystem.setup_folding">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.CodeFoldingSystem.setup_folding">[docs]</a>
    <span class="k">def</span> <span class="nf">setup_folding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup code folding functionality&quot;&quot;&quot;</span>
        <span class="c1"># Configure folding tags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">tag_configure</span><span class="p">(</span><span class="s2">&quot;folded&quot;</span><span class="p">,</span> <span class="n">elide</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">tag_configure</span><span class="p">(</span>
            <span class="s2">&quot;fold_marker&quot;</span><span class="p">,</span>
            <span class="n">background</span><span class="o">=</span><span class="s2">&quot;#E8F4FD&quot;</span><span class="p">,</span>
            <span class="n">foreground</span><span class="o">=</span><span class="s2">&quot;#0066CC&quot;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Consolas&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;bold&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Bind click events on line numbers for fold markers (if line numbers exist)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_numbers_widget</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">line_numbers_widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Button-1&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_line_number_click</span><span class="p">)</span></div>


<div class="viewcode-block" id="CodeFoldingSystem.detect_foldable_blocks">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.CodeFoldingSystem.detect_foldable_blocks">[docs]</a>
    <span class="k">def</span> <span class="nf">detect_foldable_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect blocks that can be folded&quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">foldable_blocks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Detect REPEAT blocks in Logo</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">line_upper</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

            <span class="c1"># REPEAT blocks with brackets</span>
            <span class="k">if</span> <span class="n">line_upper</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;REPEAT&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;[&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">bracket_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">start_line</span> <span class="o">=</span> <span class="n">i</span>

                <span class="c1"># Find matching closing bracket</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
                    <span class="n">line_content</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">bracket_count</span> <span class="o">+=</span> <span class="n">line_content</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span>
                    <span class="n">bracket_count</span> <span class="o">-=</span> <span class="n">line_content</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">bracket_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">end_line</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">end_line</span> <span class="o">&gt;</span> <span class="n">start_line</span><span class="p">:</span>
                            <span class="n">foldable_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start_line</span><span class="p">,</span> <span class="n">end_line</span><span class="p">))</span>
                        <span class="k">break</span>

            <span class="c1"># BASIC FOR...NEXT loops</span>
            <span class="k">elif</span> <span class="n">line_upper</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;FOR &quot;</span><span class="p">):</span>
                <span class="n">start_line</span> <span class="o">=</span> <span class="n">i</span>
                <span class="c1"># Find matching NEXT</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
                    <span class="n">next_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">next_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;NEXT&quot;</span><span class="p">):</span>
                        <span class="n">end_line</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">end_line</span> <span class="o">&gt;</span> <span class="n">start_line</span><span class="p">:</span>
                            <span class="n">foldable_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start_line</span><span class="p">,</span> <span class="n">end_line</span><span class="p">))</span>
                        <span class="k">break</span>

            <span class="c1"># PILOT subroutines (sequences between labels)</span>
            <span class="k">elif</span> <span class="n">line_upper</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;L:&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line_upper</span> <span class="o">!=</span> <span class="s2">&quot;L:END&quot;</span><span class="p">:</span>
                <span class="n">start_line</span> <span class="o">=</span> <span class="n">i</span>
                <span class="c1"># Find next label or END</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
                    <span class="n">next_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">next_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;L:&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">next_line</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="s2">&quot;END&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;E:&quot;</span><span class="p">,</span>
                    <span class="p">]:</span>
                        <span class="n">end_line</span> <span class="o">=</span> <span class="n">j</span>
                        <span class="k">if</span> <span class="n">end_line</span> <span class="o">&gt;</span> <span class="n">start_line</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Only fold if more than 2 lines</span>
                            <span class="n">foldable_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start_line</span><span class="p">,</span> <span class="n">end_line</span><span class="p">))</span>
                        <span class="k">break</span>

        <span class="k">return</span> <span class="n">foldable_blocks</span></div>


<div class="viewcode-block" id="CodeFoldingSystem.update_fold_markers">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.CodeFoldingSystem.update_fold_markers">[docs]</a>
    <span class="k">def</span> <span class="nf">update_fold_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update fold markers in line numbers&quot;&quot;&quot;</span>
        <span class="c1"># Clear existing markers</span>
        <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fold_markers</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">marker</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">marker</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error destroying fold marker: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fold_markers</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Add new markers for foldable blocks (only if line numbers exist)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_numbers_widget</span><span class="p">:</span>
            <span class="n">foldable_blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_foldable_blocks</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">start_line</span><span class="p">,</span> <span class="n">end_line</span> <span class="ow">in</span> <span class="n">foldable_blocks</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">start_line</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">folded_blocks</span><span class="p">:</span>
                    <span class="c1"># Add expand marker (▼)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_fold_marker</span><span class="p">(</span><span class="n">start_line</span><span class="p">,</span> <span class="s2">&quot;▼&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Add collapse marker (▶)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_fold_marker</span><span class="p">(</span><span class="n">start_line</span><span class="p">,</span> <span class="s2">&quot;▶&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="CodeFoldingSystem.add_fold_marker">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.CodeFoldingSystem.add_fold_marker">[docs]</a>
    <span class="k">def</span> <span class="nf">add_fold_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">is_folded</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a fold marker to the line numbers widget&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create marker button</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_numbers_widget</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
                <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Consolas&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;bold&quot;</span><span class="p">),</span>
                <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;#F0F0F0&quot;</span><span class="p">,</span>
                <span class="n">fg</span><span class="o">=</span><span class="s2">&quot;#0066CC&quot;</span><span class="p">,</span>
                <span class="n">relief</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">FLAT</span><span class="p">,</span>
                <span class="n">borderwidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">pady</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_fold</span><span class="p">(</span><span class="n">line_num</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="c1"># Position marker at the line</span>
            <span class="n">marker</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">line_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">15</span><span class="p">)</span>
            <span class="c1"># Adjust Y based on line height</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fold_markers</span><span class="p">[</span><span class="n">line_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">marker</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error adding fold marker: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="CodeFoldingSystem.toggle_fold">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.CodeFoldingSystem.toggle_fold">[docs]</a>
    <span class="k">def</span> <span class="nf">toggle_fold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_line</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Toggle folding of a code block&quot;&quot;&quot;</span>
        <span class="n">foldable_blocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_foldable_blocks</span><span class="p">()</span>

        <span class="c1"># Find the block that starts at this line</span>
        <span class="n">block_to_fold</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">foldable_blocks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">start_line</span><span class="p">:</span>
                <span class="n">block_to_fold</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">block_to_fold</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">block_to_fold</span>

        <span class="k">if</span> <span class="n">start_line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">folded_blocks</span><span class="p">:</span>
            <span class="c1"># Unfold the block</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unfold_block</span><span class="p">(</span><span class="n">start_line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fold the block</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fold_block</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

        <span class="c1"># Update markers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_fold_markers</span><span class="p">()</span></div>


<div class="viewcode-block" id="CodeFoldingSystem.fold_block">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.CodeFoldingSystem.fold_block">[docs]</a>
    <span class="k">def</span> <span class="nf">fold_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_line</span><span class="p">,</span> <span class="n">end_line</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fold a code block&quot;&quot;&quot;</span>
        <span class="c1"># Hide lines from start+1 to end</span>
        <span class="n">start_pos</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_line</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.0&quot;</span>
        <span class="n">end_pos</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">end_line</span><span class="si">}</span><span class="s2">.0&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="s2">&quot;folded&quot;</span><span class="p">,</span> <span class="n">start_pos</span><span class="p">,</span> <span class="n">end_pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folded_blocks</span><span class="p">[</span><span class="n">start_line</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_line</span>

        <span class="c1"># Add folded indicator to the start line</span>
        <span class="n">fold_indicator</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; ... [</span><span class="si">{</span><span class="n">end_line</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_line</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> lines folded]&quot;</span>

        <span class="c1"># Insert fold indicator at end of line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_line</span><span class="si">}</span><span class="s2">.end&quot;</span><span class="p">,</span> <span class="n">fold_indicator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span>
            <span class="s2">&quot;fold_marker&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_line</span><span class="si">}</span><span class="s2">.end-</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">fold_indicator</span><span class="p">)</span><span class="si">}</span><span class="s2">c&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_line</span><span class="si">}</span><span class="s2">.end&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="CodeFoldingSystem.unfold_block">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.CodeFoldingSystem.unfold_block">[docs]</a>
    <span class="k">def</span> <span class="nf">unfold_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_line</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unfold a code block&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">start_line</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">folded_blocks</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">end_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folded_blocks</span><span class="p">[</span><span class="n">start_line</span><span class="p">]</span>

        <span class="c1"># Remove folded tag</span>
        <span class="n">start_pos</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_line</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">.0&quot;</span>
        <span class="n">end_pos</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">end_line</span><span class="si">}</span><span class="s2">.0&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="s2">&quot;folded&quot;</span><span class="p">,</span> <span class="n">start_pos</span><span class="p">,</span> <span class="n">end_pos</span><span class="p">)</span>

        <span class="c1"># Remove fold indicator from start line</span>
        <span class="n">current_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_line</span><span class="si">}</span><span class="s2">.0&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_line</span><span class="si">}</span><span class="s2">.end&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot; ... [&quot;</span> <span class="ow">in</span> <span class="n">current_content</span><span class="p">:</span>
            <span class="n">indicator_start</span> <span class="o">=</span> <span class="n">current_content</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot; ... [&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text_widget</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_line</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">indicator_start</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_line</span><span class="si">}</span><span class="s2">.end&quot;</span>
            <span class="p">)</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">folded_blocks</span><span class="p">[</span><span class="n">start_line</span><span class="p">]</span></div>


<div class="viewcode-block" id="CodeFoldingSystem.on_line_number_click">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.CodeFoldingSystem.on_line_number_click">[docs]</a>
    <span class="k">def</span> <span class="nf">on_line_number_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle click on line numbers for folding&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_numbers_widget</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Get clicked line number</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span>
        <span class="n">line_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="mi">15</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Approximate line height</span>

        <span class="c1"># Check if there&#39;s a fold marker at this line</span>
        <span class="k">if</span> <span class="n">line_num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fold_markers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggle_fold</span><span class="p">(</span><span class="n">line_num</span><span class="p">)</span></div>
</div>



<span class="c1"># Integration with Time Warp IDE</span>
<div class="viewcode-block" id="TimeWarpIDE">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE">[docs]</a>
<span class="k">class</span> <span class="nc">TimeWarpIDE</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Time Warp IDE - Professional Edition&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;1000x700&quot;</span><span class="p">)</span>
        <span class="c1"># Apply a friendly theme and fonts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_theme</span><span class="p">()</span>

        <span class="c1"># Initialize interpreter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpreter</span> <span class="o">=</span> <span class="n">TimeWarpInterpreter</span><span class="p">()</span>

        <span class="c1"># Initialize plugin system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span> <span class="o">=</span> <span class="n">PluginManager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_widgets</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_menu</span><span class="p">()</span>

        <span class="c1"># Load plugins after UI is created</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_plugins</span><span class="p">()</span>

<div class="viewcode-block" id="TimeWarpIDE.log_output">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.log_output">[docs]</a>
    <span class="k">def</span> <span class="nf">log_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log a message to the output widget&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;output_text&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_text</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_text</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_text</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">tk</span><span class="o">.</span><span class="n">TclError</span><span class="p">:</span>
                <span class="c1"># Widget has been destroyed</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.create_widgets">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.create_widgets">[docs]</a>
    <span class="k">def</span> <span class="nf">create_widgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Lightweight tooltip helper</span>
        <span class="k">class</span> <span class="nc">ToolTip</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">widget</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="n">delay</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tipwindow</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Enter&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">)</span>
                <span class="n">widget</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;Leave&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipwindow</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">winfo_rootx</span><span class="p">()</span> <span class="o">+</span> <span class="mi">20</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">winfo_rooty</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">winfo_height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tipwindow</span> <span class="o">=</span> <span class="n">tw</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">)</span>
                <span class="n">tw</span><span class="o">.</span><span class="n">wm_overrideredirect</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">tw</span><span class="o">.</span><span class="n">wm_geometry</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;+</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">+</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
                    <span class="n">tw</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">justify</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span>
                    <span class="n">background</span><span class="o">=</span><span class="s2">&quot;#ffffe0&quot;</span><span class="p">,</span>
                    <span class="n">relief</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">SOLID</span><span class="p">,</span>
                    <span class="n">borderwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">ipadx</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ipady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">hide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">after_cancel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tipwindow</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tipwindow</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tipwindow</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Toolbar (modern, compact)</span>
        <span class="n">toolbar</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="n">toolbar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;nw&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">btn_style</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;padding&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">)}</span>

        <span class="c1"># Create a horizontal split: editor on the left,</span>
        <span class="c1"># output/variables/help on the right</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_pane</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">PanedWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_pane</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Left pane: editor container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor_container</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_pane</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_pane</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor_container</span><span class="p">)</span>

        <span class="c1"># Right pane: notebook for Output, Variables, Help</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_notebook</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Notebook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_pane</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_pane</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_notebook</span><span class="p">)</span>

        <span class="c1"># Try to create professional icons using Pillow;</span>
        <span class="c1"># fall back to emoji/text labels</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">tools.icon_factory</span> <span class="kn">import</span> <span class="n">create_toolbar_icons</span>

            <span class="n">icons</span> <span class="o">=</span> <span class="n">create_toolbar_icons</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">icons</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">def</span> <span class="nf">make_btn</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">icons</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">icons</span><span class="p">:</span>
                <span class="c1"># Show both icon and text for accessibility/clarity</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
                    <span class="n">toolbar</span><span class="p">,</span>
                    <span class="n">image</span><span class="o">=</span><span class="n">icons</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">compound</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="n">command</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">btn_style</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># Keep a reference to prevent garbage collection</span>
                <span class="n">b</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">icons</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">toolbar</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span> <span class="o">**</span><span class="n">btn_style</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="n">padx</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">b</span>

        <span class="c1"># Primary controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_run</span> <span class="o">=</span> <span class="n">make_btn</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="s2">&quot;Run&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_program</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_stop</span> <span class="o">=</span> <span class="n">make_btn</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">,</span> <span class="s2">&quot;Stop&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_program</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_debug</span> <span class="o">=</span> <span class="n">make_btn</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="s2">&quot;Debug&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_program</span><span class="p">)</span>
        <span class="c1"># Step and Continue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_step</span> <span class="o">=</span> <span class="n">make_btn</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="s2">&quot;Step&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_once</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_continue</span> <span class="o">=</span> <span class="n">make_btn</span><span class="p">(</span><span class="s2">&quot;run&quot;</span><span class="p">,</span> <span class="s2">&quot;Continue&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">continue_execution</span><span class="p">)</span>
        <span class="c1"># Separator</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Separator</span><span class="p">(</span><span class="n">toolbar</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">)</span>
        <span class="n">sep</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_load</span> <span class="o">=</span> <span class="n">make_btn</span><span class="p">(</span><span class="s2">&quot;load&quot;</span><span class="p">,</span> <span class="s2">&quot;Load Demo&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_demo</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btn_save</span> <span class="o">=</span> <span class="n">make_btn</span><span class="p">(</span><span class="s2">&quot;save&quot;</span><span class="p">,</span> <span class="s2">&quot;Save&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_file</span><span class="p">)</span>

        <span class="c1"># Right-aligned help button</span>
        <span class="n">help_container</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">toolbar</span><span class="p">)</span>
        <span class="n">help_container</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">icons</span> <span class="ow">and</span> <span class="s2">&quot;help&quot;</span> <span class="ow">in</span> <span class="n">icons</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_help</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
                <span class="n">help_container</span><span class="p">,</span>
                <span class="n">image</span><span class="o">=</span><span class="n">icons</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">],</span>
                <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Help&quot;</span><span class="p">,</span>
                <span class="n">compound</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s2">&quot;Help&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_help_text</span><span class="p">()),</span>
                <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_help</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">icons</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_help</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_help</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
                <span class="n">help_container</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Help&quot;</span><span class="p">,</span>
                <span class="n">command</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s2">&quot;Help&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_help_text</span><span class="p">()),</span>
                <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_help</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">)</span>

        <span class="c1"># Add tooltips</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ToolTip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_run</span><span class="p">,</span> <span class="s2">&quot;Run the program&quot;</span><span class="p">)</span>
            <span class="n">ToolTip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_stop</span><span class="p">,</span> <span class="s2">&quot;Stop program execution&quot;</span><span class="p">)</span>
            <span class="n">ToolTip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_debug</span><span class="p">,</span> <span class="s2">&quot;Run program in debug mode&quot;</span><span class="p">)</span>
            <span class="n">ToolTip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_step</span><span class="p">,</span> <span class="s2">&quot;Execute one line (step)&quot;</span><span class="p">)</span>
            <span class="n">ToolTip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_continue</span><span class="p">,</span> <span class="s2">&quot;Continue execution until breakpoint&quot;</span><span class="p">)</span>
            <span class="n">ToolTip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_load</span><span class="p">,</span> <span class="s2">&quot;Load the demo program&quot;</span><span class="p">)</span>
            <span class="n">ToolTip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_save</span><span class="p">,</span> <span class="s2">&quot;Save current file&quot;</span><span class="p">)</span>
            <span class="n">ToolTip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btn_help</span><span class="p">,</span> <span class="s2">&quot;Open language reference and help&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Initially disable Stop/Continue while idle</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_stop</span><span class="o">.</span><span class="n">state</span><span class="p">([</span><span class="s2">&quot;disabled&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btn_continue</span><span class="o">.</span><span class="n">state</span><span class="p">([</span><span class="s2">&quot;disabled&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Editor area placed in left pane</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor_container</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Text editor</span>
        <span class="n">editor_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor_frame</span><span class="p">)</span>
        <span class="n">editor_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
            <span class="n">editor_frame</span><span class="p">,</span>
            <span class="n">wrap</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Consolas&quot;</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;#fbfbfd&quot;</span><span class="p">,</span>
            <span class="n">fg</span><span class="o">=</span><span class="s2">&quot;#102a43&quot;</span><span class="p">,</span>
            <span class="n">insertbackground</span><span class="o">=</span><span class="s2">&quot;#1b3a57&quot;</span><span class="p">,</span>
            <span class="n">relief</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">FLAT</span><span class="p">,</span>
            <span class="n">bd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Scrollbars</span>
        <span class="n">y_scrollbar</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span>
            <span class="n">editor_frame</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">yview</span>
        <span class="p">)</span>
        <span class="n">x_scrollbar</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span>
            <span class="n">editor_frame</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">xview</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">config</span><span class="p">(</span>
            <span class="n">yscrollcommand</span><span class="o">=</span><span class="n">y_scrollbar</span><span class="o">.</span><span class="n">set</span><span class="p">,</span> <span class="n">xscrollcommand</span><span class="o">=</span><span class="n">x_scrollbar</span><span class="o">.</span><span class="n">set</span>
        <span class="p">)</span>

        <span class="n">y_scrollbar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">x_scrollbar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>

        <span class="c1"># Initialize code completion system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code_completion</span> <span class="o">=</span> <span class="n">IntelligentCodeCompletion</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Control buttons under editor</span>
        <span class="n">button_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor_frame</span><span class="p">)</span>
        <span class="n">button_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">ttk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">button_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Run&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_program</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
            <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">ttk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">button_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Stop&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_program</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
            <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">ttk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">button_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Debug&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_program</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
            <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">ttk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">button_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Load Demo&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load_demo</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
            <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>

        <span class="c1"># Output tab placed on the right notebook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_notebook</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_notebook</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Output&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_text</span> <span class="o">=</span> <span class="n">scrolledtext</span><span class="o">.</span><span class="n">ScrolledText</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_frame</span><span class="p">,</span>
            <span class="n">wrap</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">WORD</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
            <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;#002b36&quot;</span><span class="p">,</span>
            <span class="n">fg</span><span class="o">=</span><span class="s2">&quot;#eee8d5&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_text</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Connect interpreter to output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpreter</span><span class="o">.</span><span class="n">output_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_text</span>

        <span class="c1"># Status bar (bottom)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Ready&quot;</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>

        <span class="c1"># Bind editor events to update status</span>
        <span class="c1"># (update_status may be defined elsewhere)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;KeyRelease&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;ButtonRelease&gt;&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Variables tab on the right notebook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_notebook</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_notebook</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Variables&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">variables_tree</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Treeview</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables_frame</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,),</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;tree headings&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables_tree</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="s2">&quot;#0&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Variable&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables_tree</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables_tree</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Help tab on the right notebook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_notebook</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_notebook</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Help&quot;</span><span class="p">)</span>

        <span class="n">help_text</span> <span class="o">=</span> <span class="n">scrolledtext</span><span class="o">.</span><span class="n">ScrolledText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help_frame</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">WORD</span><span class="p">)</span>
        <span class="n">help_text</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">help_text</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_help_text</span><span class="p">())</span>
        <span class="n">help_text</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">DISABLED</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

        <span class="c1"># Graphics tab on the right notebook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphics_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_notebook</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_notebook</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphics_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Graphics&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graphics_frame</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bg</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Set canvas dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas_width</span> <span class="o">=</span> <span class="mi">400</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas_height</span> <span class="o">=</span> <span class="mi">400</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas_width</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas_height</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="c1"># Pass to interpreter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpreter</span><span class="o">.</span><span class="n">graphics_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpreter</span><span class="o">.</span><span class="n">canvas_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpreter</span><span class="o">.</span><span class="n">canvas_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas_height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpreter</span><span class="o">.</span><span class="n">origin_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpreter</span><span class="o">.</span><span class="n">origin_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin_y</span>

        <span class="c1"># Current-line highlight tag</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">tag_configure</span><span class="p">(</span><span class="s2">&quot;current_line&quot;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s2">&quot;#263238&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Real-time syntax checker</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">syntax_checker</span> <span class="o">=</span> <span class="n">RealTimeSyntaxChecker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Bind editor events for syntax checking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;&lt;KeyRelease&gt;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">syntax_checker</span><span class="o">.</span><span class="n">on_key_release</span><span class="p">)</span>

        <span class="c1"># Code folding system (without line numbers for now)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code_folding</span> <span class="o">=</span> <span class="n">CodeFoldingSystem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.setup_theme">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.setup_theme">[docs]</a>
    <span class="k">def</span> <span class="nf">setup_theme</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply simple color scheme and font choices for a modern look.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Style</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="c1"># Use a theme that supports customization if available</span>
            <span class="k">if</span> <span class="s2">&quot;clam&quot;</span> <span class="ow">in</span> <span class="n">style</span><span class="o">.</span><span class="n">theme_names</span><span class="p">():</span>
                <span class="n">style</span><span class="o">.</span><span class="n">theme_use</span><span class="p">(</span><span class="s2">&quot;clam&quot;</span><span class="p">)</span>
            <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
                <span class="s2">&quot;TButton&quot;</span><span class="p">,</span>
                <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                <span class="n">foreground</span><span class="o">=</span><span class="s2">&quot;#ffffff&quot;</span><span class="p">,</span>
                <span class="n">background</span><span class="o">=</span><span class="s2">&quot;#007acc&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">style</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s2">&quot;TButton&quot;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="s2">&quot;#005f9e&quot;</span><span class="p">)])</span>
            <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;TLabel&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="n">style</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;Treeview&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s2">&quot;#f5f7fb&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="TimeWarpIDE.create_menu">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.create_menu">[docs]</a>
    <span class="k">def</span> <span class="nf">create_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">menubar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">menubar</span><span class="p">)</span>

        <span class="c1"># File menu</span>
        <span class="n">file_menu</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">menubar</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">file_menu</span><span class="p">)</span>
        <span class="n">file_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;New&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">new_file</span><span class="p">)</span>
        <span class="n">file_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Open&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">open_file</span><span class="p">)</span>
        <span class="c1"># Run menu</span>
        <span class="n">run_menu</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">menubar</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Run&quot;</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">run_menu</span><span class="p">)</span>
        <span class="n">run_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Run Program&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_program</span><span class="p">)</span>
        <span class="n">run_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Debug Program&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_program</span><span class="p">)</span>
        <span class="n">run_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Stop Program&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_program</span><span class="p">)</span>

        <span class="c1"># Examples menu</span>
        <span class="n">examples_menu</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">menubar</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Examples&quot;</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">examples_menu</span><span class="p">)</span>
        <span class="n">examples_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hello World&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load_hello_world</span><span class="p">)</span>
        <span class="n">examples_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Math Demo&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load_math_demo</span><span class="p">)</span>
        <span class="n">examples_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Quiz Game&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load_quiz_game</span><span class="p">)</span>

        <span class="c1"># View menu</span>
        <span class="n">view_menu</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">menubar</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;View&quot;</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">view_menu</span><span class="p">)</span>
        <span class="n">view_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Dark Mode&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_dark_mode</span><span class="p">)</span>

        <span class="c1"># Plugins menu</span>
        <span class="n">plugins_menu</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">menubar</span><span class="p">,</span> <span class="n">tearoff</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">add_cascade</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Plugins&quot;</span><span class="p">,</span> <span class="n">menu</span><span class="o">=</span><span class="n">plugins_menu</span><span class="p">)</span>
        <span class="n">plugins_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reload Plugins&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reload_plugins</span><span class="p">)</span>
        <span class="n">plugins_menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">()</span>
        <span class="n">plugins_menu</span><span class="o">.</span><span class="n">add_command</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Plugin Manager&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_plugin_manager</span>
        <span class="p">)</span></div>


    <span class="c1"># end create_menu</span>

<div class="viewcode-block" id="TimeWarpIDE.update_status">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.update_status">[docs]</a>
    <span class="k">def</span> <span class="nf">update_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the status bar (placeholder for future use)&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="TimeWarpIDE.run_program">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.run_program">[docs]</a>
    <span class="k">def</span> <span class="nf">run_program</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the program in the editor&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">code</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interpreter</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_text</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interpreter</span><span class="o">.</span><span class="n">execute_program</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_variables_display</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Failed to run program: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.stop_program">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.stop_program">[docs]</a>
    <span class="k">def</span> <span class="nf">stop_program</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop program execution&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpreter</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;Program stopped&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.debug_program">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.debug_program">[docs]</a>
    <span class="k">def</span> <span class="nf">debug_program</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run program in debug mode&quot;&quot;&quot;</span>
        <span class="c1"># Placeholder for debug functionality</span>
        <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s2">&quot;Debug&quot;</span><span class="p">,</span> <span class="s2">&quot;Debug mode not yet implemented&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.step_once">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.step_once">[docs]</a>
    <span class="k">def</span> <span class="nf">step_once</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute one line (step)&quot;&quot;&quot;</span>
        <span class="c1"># Placeholder for step functionality</span>
        <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s2">&quot;Step&quot;</span><span class="p">,</span> <span class="s2">&quot;Step execution not yet implemented&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.continue_execution">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.continue_execution">[docs]</a>
    <span class="k">def</span> <span class="nf">continue_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Continue execution until breakpoint&quot;&quot;&quot;</span>
        <span class="c1"># Placeholder for continue functionality</span>
        <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s2">&quot;Continue&quot;</span><span class="p">,</span> <span class="s2">&quot;Continue execution not yet implemented&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.load_demo">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.load_demo">[docs]</a>
    <span class="k">def</span> <span class="nf">load_demo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the demo program&quot;&quot;&quot;</span>
        <span class="n">demo_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;T:Hello World!</span>
<span class="s2">T:Welcome to Time Warp IDE</span>
<span class="s2">A:name</span>
<span class="s2">T:*name*, nice to meet you!&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">demo_code</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.save_file">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.save_file">[docs]</a>
    <span class="k">def</span> <span class="nf">save_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save current file&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">(</span>
                <span class="n">defaultextension</span><span class="o">=</span><span class="s2">&quot;.tw&quot;</span><span class="p">,</span>
                <span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;Time Warp files&quot;</span><span class="p">,</span> <span class="s2">&quot;*.tw&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;All files&quot;</span><span class="p">,</span> <span class="s2">&quot;*.*&quot;</span><span class="p">)],</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Saved: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Failed to save file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.new_file">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.new_file">[docs]</a>
    <span class="k">def</span> <span class="nf">new_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new file&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;New file&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.open_file">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.open_file">[docs]</a>
    <span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open a file&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span>
                <span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;Time Warp files&quot;</span><span class="p">,</span> <span class="s2">&quot;*.tw&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;All files&quot;</span><span class="p">,</span> <span class="s2">&quot;*.*&quot;</span><span class="p">)]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Opened: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Failed to open file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.load_hello_world">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.load_hello_world">[docs]</a>
    <span class="k">def</span> <span class="nf">load_hello_world</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load Hello World example&quot;&quot;&quot;</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;T:Hello World!</span>
<span class="s2">T:Welcome to Time Warp IDE&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.load_math_demo">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.load_math_demo">[docs]</a>
    <span class="k">def</span> <span class="nf">load_math_demo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load Math Demo example&quot;&quot;&quot;</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;U:x=5</span>
<span class="s2">U:y=3</span>
<span class="s2">T:The sum of *x* and *y* is *x+y*</span>
<span class="s2">T:The product is *x*y*&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.load_quiz_game">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.load_quiz_game">[docs]</a>
    <span class="k">def</span> <span class="nf">load_quiz_game</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load Quiz Game example&quot;&quot;&quot;</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;T:Math Quiz Game</span>
<span class="s2">T:What is 2 + 2?</span>
<span class="s2">A:answer</span>
<span class="s2">Y:*answer*=4</span>
<span class="s2">T:Correct! Well done.</span>
<span class="s2">N:*answer*=4</span>
<span class="s2">T:Sorry, the answer is 4.</span>
<span class="s2">END&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">editor</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.toggle_dark_mode">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.toggle_dark_mode">[docs]</a>
    <span class="k">def</span> <span class="nf">toggle_dark_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Toggle dark mode&quot;&quot;&quot;</span>
        <span class="c1"># Placeholder for dark mode toggle</span>
        <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span><span class="s2">&quot;Dark Mode&quot;</span><span class="p">,</span> <span class="s2">&quot;Dark mode toggle not yet implemented&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.load_plugins">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.load_plugins">[docs]</a>
    <span class="k">def</span> <span class="nf">load_plugins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load all plugins on startup&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">loaded_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span><span class="o">.</span><span class="n">load_all_plugins</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plugin system initialized: </span><span class="si">{</span><span class="n">loaded_count</span><span class="si">}</span><span class="s2"> plugins loaded&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">loaded_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="n">loaded_count</span><span class="si">}</span><span class="s2"> plugins&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading plugins: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Plugin Error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Failed to load plugins: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.reload_plugins">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.reload_plugins">[docs]</a>
    <span class="k">def</span> <span class="nf">reload_plugins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload all plugins&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Unload existing plugins</span>
            <span class="n">unloaded_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span><span class="o">.</span><span class="n">unload_all_plugins</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unloaded </span><span class="si">{</span><span class="n">unloaded_count</span><span class="si">}</span><span class="s2"> plugins&quot;</span><span class="p">)</span>

            <span class="c1"># Reload plugins</span>
            <span class="n">loaded_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span><span class="o">.</span><span class="n">load_all_plugins</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_bar</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Reloaded </span><span class="si">{</span><span class="n">loaded_count</span><span class="si">}</span><span class="s2"> plugins&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plugin system reloaded: </span><span class="si">{</span><span class="n">loaded_count</span><span class="si">}</span><span class="s2"> plugins loaded&quot;</span><span class="p">)</span>

            <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span>
                <span class="s2">&quot;Plugins Reloaded&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Successfully reloaded </span><span class="si">{</span><span class="n">loaded_count</span><span class="si">}</span><span class="s2"> plugins&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reloading plugins: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;Plugin Error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Failed to reload plugins: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.show_plugin_manager">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.show_plugin_manager">[docs]</a>
    <span class="k">def</span> <span class="nf">show_plugin_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show the plugin manager dialog&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create plugin manager dialog</span>
            <span class="n">dialog</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="n">dialog</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Plugin Manager&quot;</span><span class="p">)</span>
            <span class="n">dialog</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;600x400&quot;</span><span class="p">)</span>
            <span class="n">dialog</span><span class="o">.</span><span class="n">transient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="n">dialog</span><span class="o">.</span><span class="n">grab_set</span><span class="p">()</span>

            <span class="c1"># Create main frame</span>
            <span class="n">main_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">dialog</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;10&quot;</span><span class="p">)</span>
            <span class="n">main_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Title</span>
            <span class="n">title_label</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span>
                <span class="n">main_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Installed Plugins&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Segoe UI&quot;</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="s2">&quot;bold&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">title_label</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

            <span class="c1"># Plugin list frame</span>
            <span class="n">list_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">main_frame</span><span class="p">)</span>
            <span class="n">list_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

            <span class="c1"># Create treeview for plugins</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Version&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">)</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Treeview</span><span class="p">(</span><span class="n">list_frame</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;headings&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

            <span class="c1"># Configure columns</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="s2">&quot;#0&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Plugin Name&quot;</span><span class="p">)</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Type&quot;</span><span class="p">)</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="s2">&quot;Version&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Version&quot;</span><span class="p">)</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">heading</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Status&quot;</span><span class="p">)</span>

            <span class="n">tree</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;#0&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;Version&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s2">&quot;Status&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

            <span class="c1"># Add scrollbar</span>
            <span class="n">scrollbar</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span>
                <span class="n">list_frame</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">yview</span>
            <span class="p">)</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">yscrollcommand</span><span class="o">=</span><span class="n">scrollbar</span><span class="o">.</span><span class="n">set</span><span class="p">)</span>

            <span class="n">tree</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">scrollbar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span>

            <span class="c1"># Populate plugin list</span>
            <span class="k">for</span> <span class="n">plugin_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span><span class="o">.</span><span class="n">list_plugins</span><span class="p">():</span>
                <span class="n">plugin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugin_manager</span><span class="o">.</span><span class="n">get_plugin</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">plugin</span><span class="p">:</span>
                    <span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                        <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">,</span>
                        <span class="n">text</span><span class="o">=</span><span class="n">plugin</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">values</span><span class="o">=</span><span class="p">(</span>
                            <span class="n">plugin</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">plugin_type</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
                            <span class="n">plugin</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                            <span class="s2">&quot;Loaded&quot;</span><span class="p">,</span>
                        <span class="p">),</span>
                    <span class="p">)</span>

            <span class="c1"># Button frame</span>
            <span class="n">button_frame</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">main_frame</span><span class="p">)</span>
            <span class="n">button_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="n">ttk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
                <span class="n">button_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Reload All&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reload_plugins</span>
            <span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
            <span class="n">ttk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">button_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Close&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="n">dialog</span><span class="o">.</span><span class="n">destroy</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
                <span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIGHT</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span>
                <span class="s2">&quot;Plugin Manager Error&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Failed to open plugin manager: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.update_variables_display">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.update_variables_display">[docs]</a>
    <span class="k">def</span> <span class="nf">update_variables_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the variables tree display&quot;&quot;&quot;</span>
        <span class="c1"># Clear existing items</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables_tree</span><span class="o">.</span><span class="n">get_children</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables_tree</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># Add current variables</span>
        <span class="k">for</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">var_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpreter</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables_tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">var_name</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var_value</span><span class="p">),)</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="TimeWarpIDE.get_help_text">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.TimeWarpIDE.get_help_text">[docs]</a>
    <span class="k">def</span> <span class="nf">get_help_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">TIME WARP LANGUAGE REFERENCE</span>

<span class="s2">=== PILOT COMMANDS ===</span>
<span class="s2">T:text          - Output text (variables in *VAR* format). If a T: immediately</span>
<span class="s2">                  follows Y: or N: the T: is conditional and only prints when</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="s2">                  &quot;the</span>
<span class="s2">                  match flag is set; the sentinel is consumed by this T:.</span>
<span class="s2">A:variable      - Accept input into variable</span>
<span class="s2">Y:condition     - Set the match flag when condition is TRUE (and mark the next</span>
<span class="s2">                  T: or J: as a conditional consumer)</span>
<span class="s2">N:condition     - Set the match flag when condition is TRUE (used as an</span>
<span class="s2">                  alternate conditional in many sample programs)</span>
<span class="s2">J:label         - Jump to label. If J: immediately follows a Y: or N:, it will be</span>
<span class="s2">                  treated as a conditional jump (consumes the sentinel and jumps</span>
<span class="s2">                  only when the match flag is set).</span>
<span class="s2">M:label         - Jump to label if match flag is set (does not consume the sentinel)</span>
<span class="s2">R:label         - Gosub to label (subroutine call), or extended commands:</span>
<span class="s2">  R: SND name=&quot;soundname&quot;, file=&quot;path.wav&quot; - Register a sound file</span>
<span class="s2">  R: PLAY &quot;soundname&quot; - Play a registered sound</span>
<span class="s2">  R: SAVE &quot;slotname&quot; - Save current program state</span>
<span class="s2">  R: LOAD &quot;slotname&quot; - Load saved program state</span>
<span class="s2">C:              - Return from subroutine</span>
<span class="s2">L:label         - Label definition</span>
<span class="s2">U:var=expr      - Update/Set variable</span>
<span class="s2">END             - End program</span>

<span class="s2">=== BASIC COMMANDS ===</span>
<span class="s2">LET var = expr  - Assign expression to variable</span>
<span class="s2">PRINT expr      - Output expression or string</span>
<span class="s2">INPUT var       - Get input into variable</span>
<span class="s2">GOTO line       - Jump to line number</span>
<span class="s2">IF condition THEN command  - Conditional execution</span>
<span class="s2">FOR var = start TO end [STEP step] - Loop from start to end</span>
<span class="s2">NEXT [var]     - End of FOR loop</span>
<span class="s2">GOSUB line     - Call subroutine at line number</span>
<span class="s2">RETURN         - Return from subroutine</span>
<span class="s2">END            - End program</span>
<span class="s2">REM comment    - Comment</span>
<span class="s2">DATA value1,value2,... - Store data values for READ</span>
<span class="s2">READ var1,var2,... - Read values from DATA into variables</span>
<span class="s2">RESTORE [line] - Reset data pointer for READ</span>

<span class="s2">=== GW-BASIC GRAPHICS COMMANDS ===</span>
<span class="s2">SCREEN [mode]  - Set screen mode (0=text, 1-7=graphics)</span>
<span class="s2">COLOR fg[,bg]  - Set foreground/background colors</span>
<span class="s2">PALETTE attr,color - Set color palette</span>
<span class="s2">PSET [STEP] (x,y) [,color] - Plot point at coordinates</span>
<span class="s2">PRESET [STEP] (x,y) [,color] - Erase point at coordinates</span>
<span class="s2">CIRCLE [STEP] (x,y), radius [,color [,start [,end [,aspect]]]] - Draw circle</span>
<span class="s2">DRAW &quot;string&quot;  - Execute drawing commands from string</span>
<span class="s2">PAINT [STEP] (x,y) [,paint_color [,border_color]] - Fill area</span>

<span class="s2">=== GW-BASIC SOUND COMMANDS ===</span>
<span class="s2">PLAY &quot;string&quot;  - Play music from string notation</span>
<span class="s2">SOUND freq, duration [,volume [,voice]] - Play tone</span>
<span class="s2">BEEP           - Simple beep sound</span>

<span class="s2">=== GW-BASIC FUNCTIONS ===</span>
<span class="s2">SIN(x), COS(x), TAN(x) - Trigonometric functions</span>
<span class="s2">LOG(x), SQR(x), EXP(x) - Logarithmic and exponential functions</span>
<span class="s2">ATN(x), SGN(x), ABS(x) - Arc tangent, sign, absolute value</span>
<span class="s2">LEFT$(s,n), RIGHT$(s,n), MID$(s,start[,length]) - String functions</span>
<span class="s2">INSTR(s,sub), LEN(s), CHR$(n), ASC(s) - String operations</span>
<span class="s2">STR$(n), VAL(s), SPACE$(n), STRING$(n,char) - Conversion functions</span>

<span class="s2">=== LOGO COMMANDS ===</span>
<span class="s2">FORWARD distance / FD distance - Move turtle forward by distance units</span>
<span class="s2">BACK distance / BK distance - Move turtle backward by distance units</span>
<span class="s2">LEFT degrees / LT degrees - Turn turtle left by degrees</span>
<span class="s2">RIGHT degrees / RT degrees - Turn turtle right by degrees</span>
<span class="s2">PENUP / PU - Lift the pen (stop drawing lines)</span>
<span class="s2">PENDOWN / PD - Lower the pen (start drawing lines)</span>
<span class="s2">PENCOLOR color / PC color - Set the color of the pen (name or number)</span>
<span class="s2">PENSIZE size - Set the thickness of the line drawn by the pen</span>
<span class="s2">HIDETURTLE / HT - Make the turtle invisible</span>
<span class="s2">SHOWTURTLE / ST - Make the turtle visible</span>
<span class="s2">CLEARSCREEN / CS - Clear all drawings and return turtle to home</span>
<span class="s2">CLEARTEXT / CT - Clear text from the command screen</span>
<span class="s2">HOME - Return turtle to center (0,0), facing up</span>
<span class="s2">SETXY x y - Move turtle to coordinates (x,y) without drawing&quot;&quot;&quot;</span></div>
</div>



<div class="viewcode-block" id="create_demo_program">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.create_demo_program">[docs]</a>
<span class="k">def</span> <span class="nf">create_demo_program</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a demo program for testing purposes&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;&quot;L:START</span>
<span class="s2">T:Time Warp Demo Program</span>
<span class="s2">U:A=10</span>
<span class="s2">U:B=20</span>
<span class="s2">U:SUM=*A*+*B*</span>
<span class="s2">T:Welcome to Time Warp!</span>
<span class="s2">T:A = *A*, B = *B*</span>
<span class="s2">T:Sum = *SUM*</span>
<span class="s2">END&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../api_reference.html#Time_Warp.main">[docs]</a>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
    <span class="n">TimeWarpIDE</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="c1"># Show welcome message</span>
    <span class="n">root</span><span class="o">.</span><span class="n">after</span><span class="p">(</span>
        <span class="mi">1000</span><span class="p">,</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">messagebox</span><span class="o">.</span><span class="n">showinfo</span><span class="p">(</span>
            <span class="s2">&quot;Welcome to Time Warp IDE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Welcome to Time Warp IDE - Educational Programming</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Environment!</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Features:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;• Multi-language support (PILOT, BASIC, Logo)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;• Turtle graphics</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;• Interactive debugging</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;• Hardware integration</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;• Game development</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Select a language from the menu to begin!&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">root</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Honey Badger Universe.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>