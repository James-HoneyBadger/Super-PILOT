<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Warp Web - WORKING Graphics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .run-btn {
            background: #28a745;
            color: white;
        }

        .clear-btn {
            background: #dc3545;
            color: white;
        }

        .test-btn {
            background: #007bff;
            color: white;
        }

        .editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            height: 500px;
        }

        textarea {
            width: 100%;
            height: 100%;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border: 2px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            resize: none;
        }

        .graphics-panel {
            border: 2px solid #ddd;
            border-radius: 4px;
            position: relative;
            background: white;
        }

        canvas {
            border-radius: 4px;
            display: block;
        }

        .output {
            margin-top: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-weight: bold;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üê¢ Time Warp Web IDE - WORKING Graphics Edition</h1>

        <div class="controls">
            <button class="run-btn" onclick="runProgram()">‚ñ∂ Run Program</button>
            <button class="clear-btn" onclick="clearCanvas()">üßπ Clear Graphics</button>
            <button class="test-btn" onclick="runTest()">üß™ Test Graphics</button>
            <button onclick="loadSquare()">üìê Load Square</button>
            <button onclick="loadSpiral()">üåÄ Load Spiral</button>
            <button onclick="loadHouse()">üè† Load House</button>
        </div>

        <div class="editor-container">
            <textarea id="codeEditor" placeholder="Enter your turtle graphics program here...">FORWARD 100
RIGHT 90
FORWARD 100
RIGHT 90
FORWARD 100
RIGHT 90
FORWARD 100</textarea>

            <div class="graphics-panel">
                <canvas id="turtleCanvas" width="500" height="480"></canvas>
            </div>
        </div>

        <div id="output" class="output">Ready to run turtle graphics programs!</div>
        <div id="status" class="status">Ready</div>
    </div>

    <script>
        // Simple, reliable turtle graphics that ACTUALLY WORKS
        class WorkingTurtle {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.x = canvas.width / 2;
                this.y = canvas.height / 2;
                this.angle = 0; // 0 = right, 90 = up
                this.penDown = true;
                this.color = 'blue';
                this.penWidth = 2;

                this.clearCanvas();
            }

            clearCanvas() {
                this.ctx.fillStyle = 'white';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Draw grid
                this.ctx.strokeStyle = '#f0f0f0';
                this.ctx.lineWidth = 1;
                for (let x = 0; x <= this.canvas.width; x += 20) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, 0);
                    this.ctx.lineTo(x, this.canvas.height);
                    this.ctx.stroke();
                }
                for (let y = 0; y <= this.canvas.height; y += 20) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y);
                    this.ctx.lineTo(this.canvas.width, y);
                    this.ctx.stroke();
                }

                // Draw center lines
                this.ctx.strokeStyle = '#e0e0e0';
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();
                this.ctx.moveTo(this.canvas.width / 2, 0);
                this.ctx.lineTo(this.canvas.width / 2, this.canvas.height);
                this.ctx.moveTo(0, this.canvas.height / 2);
                this.ctx.lineTo(this.canvas.width, this.canvas.height / 2);
                this.ctx.stroke();

                this.drawTurtle();
            }

            forward(distance) {
                const radians = this.angle * Math.PI / 180;
                const newX = this.x + Math.cos(radians) * distance;
                const newY = this.y - Math.sin(radians) * distance; // Y flipped for screen coords

                if (this.penDown) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(this.x, this.y);
                    this.ctx.lineTo(newX, newY);
                    this.ctx.strokeStyle = this.color;
                    this.ctx.lineWidth = this.penWidth;
                    this.ctx.stroke();
                }

                this.x = newX;
                this.y = newY;
                this.drawTurtle();
            }

            right(degrees) {
                this.angle = (this.angle - degrees) % 360;
                this.drawTurtle();
            }

            left(degrees) {
                this.angle = (this.angle + degrees) % 360;
                this.drawTurtle();
            }

            penup() {
                this.penDown = false;
            }

            pendown() {
                this.penDown = true;
            }

            setcolor(color) {
                this.color = color;
            }

            home() {
                this.x = this.canvas.width / 2;
                this.y = this.canvas.height / 2;
                this.angle = 0;
                this.drawTurtle();
            }

            drawTurtle() {
                // Clear old turtle area
                this.ctx.save();
                this.ctx.fillStyle = 'white';
                this.ctx.fillRect(this.x - 15, this.y - 15, 30, 30);

                // Redraw grid lines in turtle area
                this.ctx.strokeStyle = '#f0f0f0';
                this.ctx.lineWidth = 1;
                const startX = Math.floor((this.x - 15) / 20) * 20;
                const endX = Math.ceil((this.x + 15) / 20) * 20;
                const startY = Math.floor((this.y - 15) / 20) * 20;
                const endY = Math.ceil((this.y + 15) / 20) * 20;

                for (let x = startX; x <= endX; x += 20) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, this.y - 15);
                    this.ctx.lineTo(x, this.y + 15);
                    this.ctx.stroke();
                }
                for (let y = startY; y <= endY; y += 20) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(this.x - 15, y);
                    this.ctx.lineTo(this.x + 15, y);
                    this.ctx.stroke();
                }

                // Draw turtle
                this.ctx.translate(this.x, this.y);
                this.ctx.rotate(-this.angle * Math.PI / 180);

                this.ctx.beginPath();
                this.ctx.moveTo(10, 0);
                this.ctx.lineTo(-8, -6);
                this.ctx.lineTo(-5, 0);
                this.ctx.lineTo(-8, 6);
                this.ctx.closePath();

                this.ctx.fillStyle = this.penDown ? '#e74c3c' : '#95a5a6';
                this.ctx.fill();
                this.ctx.strokeStyle = 'black';
                this.ctx.lineWidth = 1;
                this.ctx.stroke();

                this.ctx.restore();
            }
        }

        // Simple command interpreter that ACTUALLY WORKS
        let turtle;
        let output;
        let status;

        function initTurtle() {
            const canvas = document.getElementById('turtleCanvas');
            turtle = new WorkingTurtle(canvas);
            output = document.getElementById('output');
            status = document.getElementById('status');
        }

        function log(message, isError = false) {
            output.textContent += message + '\n';
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }

        function setStatus(message, isError = false) {
            status.textContent = message;
            status.className = 'status ' + (isError ? 'error' : 'success');
        }

        function executeCommand(line) {
            const parts = line.trim().split(/\s+/);
            if (parts.length === 0) return;

            const command = parts[0].toUpperCase();
            const arg = parts[1] ? parseFloat(parts[1]) : 0;

            switch (command) {
                case 'FORWARD':
                case 'FD':
                    turtle.forward(arg);
                    log(`Moved forward ${arg} units`);
                    break;

                case 'RIGHT':
                case 'RT':
                    turtle.right(arg);
                    log(`Turned right ${arg} degrees`);
                    break;

                case 'LEFT':
                case 'LT':
                    turtle.left(arg);
                    log(`Turned left ${arg} degrees`);
                    break;

                case 'PENUP':
                case 'PU':
                    turtle.penup();
                    log('Pen up');
                    break;

                case 'PENDOWN':
                case 'PD':
                    turtle.pendown();
                    log('Pen down');
                    break;

                case 'HOME':
                    turtle.home();
                    log('Returned home');
                    break;

                case 'CLEARSCREEN':
                case 'CS':
                    turtle.clearCanvas();
                    log('Screen cleared');
                    break;

                case 'SETCOLOR':
                    const color = parts[1] || 'blue';
                    turtle.setcolor(color);
                    log(`Color set to ${color}`);
                    break;

                default:
                    if (command && !command.startsWith('#')) {
                        log(`Unknown command: ${command}`, true);
                    }
            }
        }

        function runProgram() {
            if (!turtle) initTurtle();

            output.textContent = '';
            setStatus('Running program...');
            log('=== Starting program ===');

            const code = document.getElementById('codeEditor').value;
            const lines = code.split('\n');

            try {
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line && !line.startsWith('#')) {
                        executeCommand(line);
                    }
                }
                log('=== Program completed successfully ===');
                setStatus('Program completed successfully!');
            } catch (error) {
                log(`Error: ${error.message}`, true);
                setStatus(`Error: ${error.message}`, true);
            }
        }

        function clearCanvas() {
            if (!turtle) initTurtle();
            turtle.clearCanvas();
            output.textContent = 'Canvas cleared.\n';
            setStatus('Canvas cleared');
        }

        function runTest() {
            if (!turtle) initTurtle();

            output.textContent = '';
            log('=== Running graphics test ===');

            try {
                turtle.clearCanvas();
                turtle.forward(50);
                turtle.right(90);
                turtle.forward(50);
                turtle.right(90);
                turtle.forward(50);
                turtle.right(90);
                turtle.forward(50);

                log('Test completed successfully!');
                setStatus('Test completed successfully!');
            } catch (error) {
                log(`Test error: ${error.message}`, true);
                setStatus(`Test error: ${error.message}`, true);
            }
        }

        function loadSquare() {
            document.getElementById('codeEditor').value = `# Draw a square
CLEARSCREEN
FORWARD 100
RIGHT 90
FORWARD 100
RIGHT 90
FORWARD 100
RIGHT 90
FORWARD 100`;
        }

        function loadSpiral() {
            document.getElementById('codeEditor').value = `# Draw a spiral
CLEARSCREEN
SETCOLOR red
FORWARD 10
RIGHT 91
FORWARD 20
RIGHT 91
FORWARD 30
RIGHT 91
FORWARD 40
RIGHT 91
FORWARD 50
RIGHT 91
FORWARD 60
RIGHT 91
FORWARD 70
RIGHT 91
FORWARD 80`;
        }

        function loadHouse() {
            document.getElementById('codeEditor').value = `# Draw a house
CLEARSCREEN
# House base
FORWARD 100
RIGHT 90
FORWARD 100
RIGHT 90
FORWARD 100
RIGHT 90
FORWARD 100
RIGHT 90

# Roof
FORWARD 100
LEFT 45
FORWARD 70
RIGHT 90
FORWARD 70
LEFT 45
FORWARD 100`;
        }

        // Initialize when page loads
        window.addEventListener('load', initTurtle);
    </script>
</body>

</html>